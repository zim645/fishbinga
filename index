<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binga Marketplace - Buy & Sell Fish, Livestock, Goods</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #d4ac0d;
            --accent: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #333333;
            --border: #e0e0e0;
            --tourist: #8e44ad;
            --whatsapp: #25D366;
            --admin: #8e44ad;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .site-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-top {
            background: var(--primary);
            color: white;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-top .header-container {
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--primary);
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--secondary);
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-text span {
            font-size: 12px;
            color: #666;
        }
        
        /* Auth in top-right corner */
        .auth-container {
            position: relative;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-btn {
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .auth-btn.login {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .auth-btn.login:hover {
            background: var(--primary);
            color: white;
        }
        
        .auth-btn.register {
            background: var(--primary);
            color: white;
        }
        
        .auth-btn.register:hover {
            background: #154360;
        }
        
        .auth-btn.logout {
            background: var(--danger);
            color: white;
        }
        
        .auth-btn.logout:hover {
            background: #c0392b;
        }
        
        .admin-btn {
            background: var(--admin);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .admin-btn:hover {
            background: #7d3c98;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }
        
        .user-avatar.admin {
            background: var(--admin);
        }
        
        .user-name {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 10px;
        }
        
        .auth-modal-content {
            background: white;
            border-radius: 8px;
            width: 400px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .auth-tab:hover {
            background: #f8f9fa;
        }
        
        .auth-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .auth-form {
            padding: 25px;
        }
        
        .auth-form h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 82, 118, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            background: #154360;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Navigation */
        .main-nav {
            background: white;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            flex-wrap: wrap;
        }
        
        .nav-link {
            padding: 15px 20px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .nav-link.tourist {
            color: var(--tourist);
        }
        
        .nav-link.tourist:hover, .nav-link.tourist.active {
            color: var(--tourist);
            border-bottom-color: var(--tourist);
        }
        
        .post-ad-btn {
            margin-left: auto;
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .post-ad-btn:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }
        
        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 140px;
            height: fit-content;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .category-list, .location-list {
            list-style: none;
        }
        
        .category-item, .location-item {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
            transition: all 0.3s;
        }
        
        .category-item:hover, .location-item:hover {
            background: #f8f9fa;
            padding-left: 5px;
        }
        
        .category-item a, .location-item a {
            text-decoration: none;
            color: #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .category-item a:hover, .location-item a:hover {
            color: var(--primary);
        }
        
        .category-count, .location-count {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            min-width: 30px;
            text-align: center;
        }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .product-image {
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .product-image img, .product-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-image img,
        .product-card:hover .product-image video {
            transform: scale(1.05);
        }
        
        .product-price {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 16px;
            backdrop-filter: blur(5px);
        }
        
        .product-details {
            padding: 15px;
        }
        
        .product-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 16px;
            line-height: 1.4;
            min-height: 45px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-meta {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 40px;
        }
        
        .product-location {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .whatsapp-btn {
            background: var(--whatsapp);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        
        .whatsapp-btn:hover {
            background: #128C7E;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 211, 102, 0.2);
        }
        
        /* Tourist Attraction Cards */
        .attraction-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--tourist);
        }
        
        .attraction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .attraction-image {
            height: 220px;
            background: linear-gradient(45deg, #e0d0f0, #d0c0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .attraction-image img, .attraction-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .attraction-card:hover .attraction-image img,
        .attraction-card:hover .attraction-image video {
            transform: scale(1.05);
        }
        
        .attraction-type {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--tourist);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }
        
        /* Search Bar */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .search-box {
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 82, 118, 0.1);
        }
        
        .search-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #154360;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Footer */
        .site-footer {
            background: var(--dark);
            color: white;
            margin-top: 50px;
            padding: 40px 0;
        }
        
        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: white;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: white;
            padding-left: 5px;
        }
        
        /* Dashboard */
        .dashboard-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .dashboard-header.admin {
            background: linear-gradient(135deg, var(--admin), #6c3483);
            color: white;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-card.admin .stat-number {
            color: var(--admin);
        }
        
        /* Admin Panel */
        .admin-panel {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .admin-tab:hover {
            background: #f8f9fa;
        }
        
        .admin-tab.active {
            border-bottom: 3px solid var(--admin);
            color: var(--admin);
        }
        
        /* Image Upload Preview */
        .image-upload-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview {
            width: 140px;
            height: 140px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            transition: border-color 0.3s;
        }
        
        .image-preview:hover {
            border-color: var(--primary);
        }
        
        .image-preview img, .image-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .remove-image:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        /* Status badges */
        .status-badge {
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-pending {
            background: var(--warning);
            color: white;
        }
        
        .status-active {
            background: var(--accent);
            color: white;
        }
        
        .status-rejected {
            background: var(--danger);
            color: white;
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .action-btn.approve {
            background: var(--accent);
            color: white;
        }
        
        .action-btn.approve:hover {
            background: #229954;
        }
        
        .action-btn.reject {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.reject:hover {
            background: #c0392b;
        }
        
        .action-btn.edit {
            background: var(--primary);
            color: white;
        }
        
        .action-btn.edit:hover {
            background: #154360;
        }
        
        .action-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.delete:hover {
            background: #c0392b;
        }
        
        .action-btn.view {
            background: var(--tourist);
            color: white;
        }
        
        .action-btn.view:hover {
            background: #7d3c98;
        }
        
        /* Admin specific buttons */
        .action-btn.feature {
            background: var(--warning);
            color: white;
        }
        
        .action-btn.feature:hover {
            background: #d68910;
        }
        
        .action-btn.unfeature {
            background: #95a5a6;
            color: white;
        }
        
        .action-btn.unfeature:hover {
            background: #7f8c8d;
        }
        
        .action-btn.ban {
            background: #2c3e50;
            color: white;
        }
        
        .action-btn.ban:hover {
            background: #1a252f;
        }
        
        /* Image upload button */
        .image-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .image-upload-btn:hover {
            background: #154360;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Upload progress */
        .upload-progress {
            width: 100%;
            background: #f0f0f0;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
            overflow: hidden;
        }
        
        .upload-progress-bar {
            height: 10px;
            background: linear-gradient(90deg, var(--accent), #2ecc71);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s;
        }
        
        /* Camera button */
        .camera-btn, .batch-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            margin-left: 10px;
            transition: all 0.3s;
            border: none;
        }
        
        .camera-btn:hover, .batch-upload-btn:hover {
            background: #b7950b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(212, 172, 13, 0.2);
        }
        
        .batch-upload-btn {
            background: var(--tourist);
        }
        
        .batch-upload-btn:hover {
            background: #7d3c98;
            box-shadow: 0 4px 8px rgba(142, 68, 173, 0.2);
        }
        
        /* File type indicator */
        .file-type-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }
        
        /* Media gallery modal */
        .media-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .media-modal-content {
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            background: transparent;
            position: relative;
        }
        
        .media-slider {
            width: 100%;
            height: 70vh;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .media-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .media-slide.active {
            opacity: 1;
        }
        
        .media-slide img, .media-slide video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 4px;
        }
        
        .close-media {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .close-media:hover {
            background: rgba(0,0,0,0.9);
            transform: rotate(90deg);
        }
        
        .prev-media, .next-media {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .prev-media:hover, .next-media:hover {
            background: rgba(0,0,0,0.9);
            transform: translateY(-50%) scale(1.1);
        }
        
        .prev-media { left: 20px; }
        .next-media { right: 20px; }
        
        .media-thumbnails {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .media-thumb {
            width: 80px;
            height: 80px;
            border: 2px solid transparent;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s;
        }
        
        .media-thumb:hover {
            border-color: rgba(255,255,255,0.5);
        }
        
        .media-thumb.active {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        
        .media-thumb img, .media-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Media counter */
        .media-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(5px);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(.active) {
            background: #f8f9fa;
            transform: translateY(-2px);
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Storage stats */
        .storage-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .storage-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .storage-used {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #2ecc71);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* Video player controls */
        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(5px);
        }
        
        .video-play-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .video-play-btn:hover {
            transform: scale(1.1);
        }
        
        .video-progress {
            flex: 1;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .video-progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
        }
        
        /* Verification badge */
        .verified-badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        
        /* No products message */
        .no-products {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 8px;
            grid-column: 1 / -1;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        /* Featured Products */
        .featured-products {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title.tourist {
            color: var(--tourist);
        }
        
        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: inherit;
        }
        
        /* Welcome Message */
        .welcome-message {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .welcome-message h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .welcome-message p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 25px;
            opacity: 0.9;
        }
        
        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .cta-button {
            padding: 15px 30px;
            background: white;
            color: var(--primary);
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .cta-button.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .cta-button.secondary:hover {
            background: white;
            color: var(--primary);
        }
        
        /* How it works */
        .how-it-works {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .step-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        
        .step-card h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        /* Tourist attractions at bottom */
        .tourist-attractions-bottom {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid var(--border);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success {
            border-left: 4px solid var(--accent);
        }
        
        .toast-error {
            border-left: 4px solid var(--danger);
        }
        
        .toast-warning {
            border-left: 4px solid var(--warning);
        }
        
        .toast-info {
            border-left: 4px solid var(--primary);
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--primary);
            cursor: pointer;
            padding: 10px;
        }
        
        /* Admin Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .admin-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }
        
        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        
        .admin-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 30px;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 10px;
            }
            
            .post-ad-btn {
                margin: 10px 0 0 0;
            }
            
            .header-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px 20px;
            }
            
            .auth-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-box select {
                max-width: 100% !important;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                padding: 12px 20px;
                border-bottom: 1px solid var(--border);
            }
            
            .media-slider {
                height: 50vh;
            }
            
            .prev-media, .next-media {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .mobile-menu-toggle {
                display: block;
                position: absolute;
                right: 20px;
                top: 15px;
            }
            
            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
            }
            
            .nav-links.show {
                display: flex;
            }
            
            .nav-link {
                width: 100%;
                text-align: center;
                padding: 12px;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .image-upload-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .image-preview {
                width: 100px;
                height: 100px;
            }
            
            .media-slider {
                height: 40vh;
            }
            
            .media-thumb {
                width: 60px;
                height: 60px;
            }
            
            .welcome-message {
                padding: 30px 20px;
            }
            
            .welcome-message h2 {
                font-size: 24px;
            }
            
            .welcome-message p {
                font-size: 16px;
            }
            
            .cta-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .cta-button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .auth-modal-content {
                width: 95%;
                max-height: 85vh;
                margin: 10px;
            }
            
            .auth-form {
                padding: 20px 15px;
            }
            
            .auth-tabs {
                flex-wrap: wrap;
            }
            
            .auth-tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-control {
                padding: 10px;
                font-size: 16px;
            }
            
            .btn-primary {
                padding: 12px;
            }
            
            .auth-form h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .dashboard-header {
                padding: 20px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="header-top">
        <div class="header-container">
            <div>
                <i class="fas fa-phone-alt"></i> +263 77 286 3815 | 
                <i class="fas fa-map-marker-alt"></i> Binga, Lake Kariba
            </div>
            <div>
                <i class="fab fa-whatsapp"></i> WhatsApp: +263 77 286 3815
            </div>
        </div>
    </div>
    
    <!-- Main Header -->
    <header class="site-header">
        <div class="header-container">
            <!-- Logo -->
            <a href="#" class="logo">
                <div class="logo-icon">üêü</div>
                <div class="logo-text">
                    <h1>Binga Marketplace</h1>
                    <span>Buy & Sell Fish, Livestock & More</span>
                </div>
            </a>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Auth Section in top-right corner ONLY -->
            <div class="auth-container">
                <div class="auth-buttons" id="authButtons">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <!-- User Menu -->
                <div class="user-menu" id="userMenu" style="display: none;">
                    <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">JD</div>
                    <div>
                        <div class="user-name" id="userName">John Doe</div>
                        <button class="auth-btn logout" onclick="logout()">Logout</button>
                        <button class="admin-btn" id="adminAccessBtn" style="display: none;" onclick="showSection('admin')">Admin Panel</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <ul class="nav-links" id="navLinks">
                <li><a href="#" class="nav-link active" onclick="showSection('home')">Home</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('fish')">Fish</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('livestock')">Livestock</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('agriculture')">Agriculture</a></li>
                <li><a href="#" class="nav-link tourist" onclick="showSection('tourism')">Tourism</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('services')">Services</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('property')">Property</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('vehicles')">Vehicles</a></li>
            </ul>
            
            <button class="post-ad-btn" onclick="showPostAdForm()">
                <i class="fas fa-plus-circle"></i> Post Free Ad
            </button>
        </div>
    </nav>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Main Content -->
    <div id="mainContent">
        <!-- Home/Marketplace Section -->
        <div id="homeSection">
            <!-- Welcome Message -->
            <div class="welcome-message">
                <h2>Welcome to Binga Marketplace!</h2>
                <p>The first digital marketplace for Binga community. Buy and sell fish, livestock, agricultural products, and services directly with your neighbors.</p>
                
                <div class="cta-buttons">
                    <button class="cta-button" onclick="showPostAdForm()">
                        <i class="fas fa-plus-circle"></i> Post Your First Ad
                    </button>
                    <button class="cta-button secondary" onclick="showSection('tourism')">
                        <i class="fas fa-camera"></i> Explore Tourist Attractions
                    </button>
                </div>
            </div>
            
            <!-- How It Works -->
            <div>
                <h2 class="section-title">
                    <i class="fas fa-play-circle"></i> How It Works
                </h2>
                
                <div class="how-it-works">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3>Register & Post</h3>
                        <p>Create your free seller account and post your products with photos and videos</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3>Upload Media</h3>
                        <p>Upload unlimited photos and videos of your products directly from your device</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3>Admin Approval</h3>
                        <p>Our administrator reviews and approves your listing to ensure quality</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3>Sell & Earn</h3>
                        <p>Buyers contact you via WhatsApp and you complete the sale in person</p>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="What are you looking for?">
                    <select class="form-control" id="categorySelect" style="max-width: 200px;">
                        <option value="">All Categories</option>
                        <option value="fish">Fish</option>
                        <option value="goat">Goats</option>
                        <option value="cow">Cattle</option>
                        <option value="poultry">Poultry</option>
                        <option value="agriculture">Agriculture</option>
                        <option value="tourism">Tourism</option>
                    </select>
                    <select class="form-control" id="locationSelect" style="max-width: 200px;">
                        <option value="">All Locations</option>
                        <option value="Siachilaba">Siachilaba</option>
                        <option value="Kariyangwe">Kariyangwe</option>
                        <option value="Binga Centre">Binga Centre</option>
                        <option value="Chete Island">Chete Island</option>
                        <option value="Other">Other Areas</option>
                    </select>
                    <button class="search-btn" onclick="searchProducts()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
            
            <!-- Featured Products -->
            <div class="featured-products">
                <h2 class="section-title">
                    <i class="fas fa-fire"></i> Marketplace Listings
                </h2>
                
                <div id="marketplaceMessage" class="no-products" style="display: none;">
                    <div style="font-size: 60px; margin-bottom: 20px;">üè™</div>
                    <h3>Marketplace is Empty</h3>
                    <p>No approved products have been listed yet. Be the first to post!</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="showPostAdForm()" style="margin: 10px;">
                            <i class="fas fa-plus-circle"></i> Post Your First Ad
                        </button>
                    </div>
                </div>
                
                <div class="products-grid" id="featuredProducts">
                    <!-- Approved products will be loaded here -->
                </div>
                
                <!-- Pagination for Featured Products -->
                <div class="pagination" id="featuredPagination" style="display: none;"></div>
            </div>
            
            <div class="main-container">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Categories</h3>
                        <ul class="category-list" id="categoryList">
                            <!-- Categories will be loaded here -->
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Locations</h3>
                        <ul class="location-list" id="locationList">
                            <!-- Locations will be loaded here -->
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Sell Fast Tips</h3>
                        <ul style="list-style: none; color: #666; font-size: 14px;">
                            <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Upload clear photos & videos</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Show products from different angles</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Take photos in good daylight</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Set fair prices</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Include WhatsApp number</span>
                            </li>
                            <li style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-check-circle" style="color: var(--accent);"></i>
                                <span>Respond quickly to buyers</span>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Storage Stats -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Storage Usage</h3>
                        <div class="storage-stats">
                            <div>Media Storage: <span id="storageUsed">0 MB</span> / <span id="storageTotal">5000 MB</span></div>
                            <div class="storage-bar">
                                <div class="storage-used" id="storageBar"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                <i class="fas fa-info-circle"></i> IndexedDB can store up to 5GB
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- Products Grid -->
                <div>
                    <h2 class="section-title">
                        <i class="fas fa-clock"></i> Recent Listings
                    </h2>
                    
                    <div class="products-grid" id="recentProducts">
                        <!-- Recent products will be loaded here -->
                    </div>
                    
                    <div id="recentProductsMessage" class="no-products" style="display: none;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì¶</div>
                        <h3>No Recent Listings</h3>
                        <p>Check back soon or be the first to post!</p>
                    </div>
                    
                    <!-- Pagination for Recent Products -->
                    <div class="pagination" id="recentPagination" style="display: none;"></div>
                </div>
            </div>
            
            <!-- TOURIST ATTRACTIONS AT BOTTOM -->
            <div class="tourist-attractions-bottom" id="touristBottomSection">
                <h2 class="section-title tourist">
                    <i class="fas fa-camera"></i> Binga Tourist Attractions
                </h2>
                
                <div id="noAttractionsMessage" class="no-products" style="display: none;">
                    <div style="font-size: 60px; margin-bottom: 20px;">üèûÔ∏è</div>
                    <h3>No Tourist Attractions Listed</h3>
                    <p>Administrators can add Binga's beautiful attractions here</p>
                </div>
                
                <div class="products-grid" id="touristAttractions">
                    <!-- Tourist attractions will be loaded here -->
                </div>
                
                <!-- Pagination for Tourist Attractions -->
                <div class="pagination" id="touristPagination" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Tourism Section -->
        <div id="tourismSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-camera"></i> Binga Tourist Attractions</h2>
                <p>Discover the beauty of Binga - Lake Kariba, Hot Springs, Beaches & More</p>
            </div>
            
            <div id="tourismContent">
                <!-- Tourism content will be loaded here -->
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2>My Dashboard</h2>
                <p>Manage your products and account</p>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="myProductsCount">0</div>
                    <div>My Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myViewsCount">0</div>
                    <div>Total Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myPendingCount">0</div>
                    <div>Pending Approval</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myActiveCount">0</div>
                    <div>Active Listings</div>
                </div>
            </div>
            
            <div class="admin-panel" id="userDashboard">
                <!-- User dashboard content will be loaded here -->
            </div>
        </div>
        
        <!-- Admin Panel Section -->
        <div id="adminSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header admin">
                <h2><i class="fas fa-crown"></i> Administrator Control Panel</h2>
                <p>Manage marketplace, approve listings, control tourist attractions - FULL CONTROL</p>
                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 4px; font-size: 14px;">
                        <i class="fas fa-user-shield"></i> Logged in as: <span id="adminUsername">Admin</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 4px; font-size: 14px;">
                        <i class="fas fa-star"></i> Super Admin Access
                    </div>
                </div>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card admin">
                    <div class="stat-number" id="totalProductsCount">0</div>
                    <div>Total Products</div>
                </div>
                <div class="stat-card admin">
                    <div class="stat-number" id="totalUsersCount">0</div>
                    <div>Total Users</div>
                </div>
                <div class="stat-card admin">
                    <div class="stat-number" id="pendingApprovalsCount">0</div>
                    <div>Pending Approvals</div>
                </div>
                <div class="stat-card admin">
                    <div class="stat-number" id="totalAttractionsCount">0</div>
                    <div>Tourist Attractions</div>
                </div>
            </div>
            
            <div class="admin-panel">
                <div class="admin-tabs">
                    <div class="admin-tab active" onclick="showAdminTab('pending')">
                        <i class="fas fa-clock"></i> Pending Ads
                        <span id="pendingBadge" class="status-badge status-pending" style="margin-left: 8px; font-size: 10px;">0</span>
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('products')">
                        <i class="fas fa-box"></i> All Products
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('attractions')">
                        <i class="fas fa-camera"></i> Tourist Attractions
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i> Users
                        <span id="usersBadge" class="status-badge" style="margin-left: 8px; font-size: 10px; background: var(--primary);">0</span>
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('reported')">
                        <i class="fas fa-flag"></i> Reported
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('stats')">
                        <i class="fas fa-chart-bar"></i> Statistics
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </div>
                    <div class="admin-tab" onclick="showAdminTab('danger')" style="color: var(--danger);">
                        <i class="fas fa-exclamation-triangle"></i> Danger Zone
                    </div>
                </div>
                
                <div id="adminContent">
                    <!-- Admin content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Post Ad Form -->
        <div id="postAdSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2>Post Free Advertisement</h2>
                <p>Reach thousands of buyers in Binga</p>
            </div>
            
            <div class="admin-panel">
                <div id="postAdForm">
                    <!-- Post ad form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Add Tourist Attraction Form -->
        <div id="addAttractionSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-plus-circle"></i> Add Tourist Attraction</h2>
                <p>Showcase Binga's beautiful places to visitors</p>
            </div>
            
            <div class="admin-panel">
                <div id="addAttractionForm">
                    <!-- Add attraction form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Edit Tourist Attraction Form -->
        <div id="editAttractionSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-edit"></i> Edit Tourist Attraction</h2>
                <p>Update attraction details</p>
            </div>
            
            <div class="admin-panel">
                <div id="editAttractionForm">
                    <!-- Edit attraction form will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Media Gallery Modal -->
    <div class="media-modal" id="mediaModal">
        <button class="close-media" onclick="closeMediaModal()">√ó</button>
        <div class="media-modal-content">
            <div class="media-slider" id="mediaSlider">
                <!-- Media slides will be loaded here -->
            </div>
            <button class="prev-media" onclick="prevMedia()">‚Äπ</button>
            <button class="next-media" onclick="nextMedia()">‚Ä∫</button>
            <div class="media-counter" id="mediaCounter">1 / 1</div>
            <div class="media-thumbnails" id="mediaThumbnails">
                <!-- Media thumbnails will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Binga Marketplace</h3>
                <p>The first online marketplace in Binga. Buy and sell fish, livestock, agricultural products, services, and more.</p>
                <p style="margin-top: 15px;">
                    <i class="fas fa-phone"></i> +263 77 286 3815<br>
                    <i class="fas fa-envelope"></i> info@bingamarket.co.zw
                </p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showSection('home')">Home</a></li>
                    <li><a href="#" onclick="showSection('fish')">Fish Market</a></li>
                    <li><a href="#" onclick="showSection('livestock')">Livestock</a></li>
                    <li><a href="#" onclick="showSection('tourism')">Tourist Attractions</a></li>
                    <li><a href="#" onclick="showPostAdForm()">Post Free Ad</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showToast('Contact +263 77 286 3815 for all inquiries', 'info')">Contact Administrator</a></li>
                    <li><a href="#" onclick="showToast('Safety tips coming soon', 'info')">Safety Tips</a></li>
                    <li><a href="#" onclick="showToast('How to sell on Binga Marketplace', 'info')">How to Sell</a></li>
                    <li><a href="#" onclick="showToast('Terms & Conditions coming soon', 'info')">Terms & Conditions</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <a href="#" style="color: white; font-size: 24px;" onclick="showToast('Facebook page coming soon', 'info')"><i class="fab fa-facebook"></i></a>
                    <a href="https://wa.me/263772863815" style="color: white; font-size: 24px;" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" style="color: white; font-size: 24px;" onclick="showToast('Twitter page coming soon', 'info')"><i class="fab fa-twitter"></i></a>
                </div>
                <p style="margin-top: 20px; color: #bbb; font-size: 14px;">
                    ¬© 2024 Binga Marketplace. Administrator Contact: +263 77 286 3815
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthForm('login')">Login</div>
                <div class="auth-tab" onclick="showAuthForm('register')">Register as Seller</div>
            </div>
            
            <div class="auth-form">
                <div id="loginTypeSelector" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid var(--border); padding-bottom: 10px;">
                        <button class="auth-type-btn active" onclick="setLoginType('seller')" style="flex: 1; padding: 10px; text-align: center; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Seller Login</button>
                        <button class="auth-type-btn" onclick="setLoginType('admin')" style="flex: 1; padding: 10px; text-align: center; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Admin Login</button>
                    </div>
                </div>
                
                <div id="loginForm">
                    <h3 id="loginTitle">Login to Seller Account</h3>
                    <div class="form-group">
                        <label class="form-label" id="loginLabel">Username</label>
                        <input type="text" class="form-control" id="loginEmail" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                        <div style="text-align: right; margin-top: 5px;">
                            <a href="#" style="color: var(--primary); font-size: 12px;" onclick="handleForgotPassword()">Forgot Password?</a>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="login()">Login</button>
                    <div class="password-reset">
                        <p style="color: #666; font-size: 14px; margin-top: 10px; text-align: center;">
                            Note: For security reasons, you need to register again if you forget your password.
                        </p>
                    </div>
                </div>
                
                <div id="registerForm" style="display: none;">
                    <h3>Create Seller Account</h3>
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" class="form-control" id="registerName" placeholder="Full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number*</label>
                        <input type="tel" class="form-control" id="registerPhone" placeholder="263771234567" required>
                        <small style="color: #666; display: block; margin-top: 5px;">Enter phone number without + sign (e.g., 263771234567)</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username*</label>
                        <input type="text" class="form-control" id="registerUsername" placeholder="Choose a username" required>
                        <small style="color: #666; display: block; margin-top: 5px;">This will be used to login</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password*</label>
                        <input type="password" class="form-control" id="registerPassword" placeholder="Create password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password*</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location in Binga*</label>
                        <select class="form-control" id="registerLocation" required>
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="register()">Create Seller Account</button>
                    <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                        Note: All accounts must be approved by administrator
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // IndexedDB Database Configuration for Scalable Storage
        const DB_NAME = 'binga_marketplace';
        const DB_VERSION = 9; // Incremented to update structure
        
        // Database schema
        const DB_SCHEMA = {
            users: {
                key: 'id',
                indexes: ['username', 'phone', 'type', 'approved', 'location', 'status']
            },
            products: {
                key: 'id',
                indexes: ['sellerId', 'category', 'location', 'status', 'approved', 'createdAt', 'featured']
            },
            attractions: {
                key: 'id',
                indexes: ['type', 'location', 'status', 'addedBy', 'featured']
            },
            media: {
                key: 'id',
                indexes: ['entityId', 'entityType', 'mediaType', 'uploadedAt']
            },
            categories: {
                key: 'id'
            },
            locations: {
                key: 'id'
            },
            attractionTypes: {
                key: 'id'
            },
            settings: {
                key: 'id'
            },
            reports: {
                key: 'id'
            },
            logs: {
                key: 'id'
            }
        };
        
        // Database instance
        let db = null;
        let currentUser = null;
        let loginType = 'seller';
        let uploadedMedia = [];
        let isUploading = false;
        let currentMediaIndex = 0;
        let currentMediaItems = [];
        let currentProducts = [];
        
        // Initialize IndexedDB
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.error);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('IndexedDB initialized successfully');
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    const oldVersion = event.oldVersion;
                    
                    // Create object stores if they don't exist
                    const stores = ['users', 'products', 'attractions', 'media', 'categories', 'locations', 'attractionTypes', 'settings', 'reports', 'logs'];
                    
                    stores.forEach(storeName => {
                        if (!db.objectStoreNames.contains(storeName)) {
                            let store;
                            if (storeName === 'users') {
                                store = db.createObjectStore('users', { keyPath: 'id' });
                                store.createIndex('username', 'username', { unique: true });
                                store.createIndex('phone', 'phone', { unique: true });
                                store.createIndex('type', 'type');
                                store.createIndex('approved', 'approved');
                                store.createIndex('location', 'location');
                                store.createIndex('status', 'status');
                            } else if (storeName === 'products') {
                                store = db.createObjectStore('products', { keyPath: 'id' });
                                store.createIndex('sellerId', 'sellerId');
                                store.createIndex('category', 'category');
                                store.createIndex('location', 'location');
                                store.createIndex('status', 'status');
                                store.createIndex('approved', 'approved');
                                store.createIndex('createdAt', 'createdAt');
                                store.createIndex('featured', 'featured');
                            } else if (storeName === 'attractions') {
                                store = db.createObjectStore('attractions', { keyPath: 'id' });
                                store.createIndex('type', 'type');
                                store.createIndex('location', 'location');
                                store.createIndex('status', 'status');
                                store.createIndex('addedBy', 'addedBy');
                                store.createIndex('featured', 'featured');
                            } else if (storeName === 'media') {
                                store = db.createObjectStore('media', { keyPath: 'id' });
                                store.createIndex('entityId', 'entityId');
                                store.createIndex('entityType', 'entityType');
                                store.createIndex('mediaType', 'mediaType');
                                store.createIndex('uploadedAt', 'uploadedAt');
                            } else {
                                store = db.createObjectStore(storeName, { keyPath: 'id' });
                            }
                        }
                    });
                    
                    // Add sample data if new database
                    if (oldVersion < 1) {
                        addSampleData(db);
                    }
                };
            });
        }
        
        // Add sample data to the database
        async function addSampleData(db) {
            const transaction = db.transaction(['users', 'products', 'attractions', 'categories', 'locations', 'attractionTypes', 'settings'], 'readwrite');
            
            // Sample users - UPDATED ADMIN CREDENTIALS
            const users = [
                {
                    id: 1,
                    username: 'Munkuli@1996',
                    password: 'PickGod',
                    name: 'Binga Administrator',
                    phone: '263772863815',
                    email: 'admin@bingamarket.co.zw',
                    location: 'Binga Centre',
                    type: 'admin',
                    role: 'superadmin',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 5.0,
                    approved: true,
                    status: 'active',
                    permissions: ['all']
                },
                {
                    id: 2,
                    username: 'johnfish',
                    password: 'john123',
                    name: 'John Fishing',
                    phone: '263773456789',
                    email: 'john@email.com',
                    location: 'Siachilaba',
                    type: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.5,
                    approved: true,
                    status: 'active'
                },
                {
                    id: 3,
                    username: 'marygoat',
                    password: 'mary123',
                    name: 'Mary Livestock',
                    phone: '263774567890',
                    email: 'mary@email.com',
                    location: 'Kariyangwe',
                    type: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.8,
                    approved: true,
                    status: 'active'
                }
            ];
            
            // Sample categories
            const categories = [
                {id: 'fish', name: 'Fish & Seafood', icon: 'üêü'},
                {id: 'goat', name: 'Goats', icon: 'üêê'},
                {id: 'cow', name: 'Cattle', icon: 'üêÑ'},
                {id: 'poultry', name: 'Poultry', icon: 'üêì'},
                {id: 'agriculture', name: 'Agriculture', icon: 'üåæ'},
                {id: 'tourism', name: 'Tourism Services', icon: 'üèûÔ∏è'},
                {id: 'services', name: 'Services', icon: 'üîß'},
                {id: 'property', name: 'Property', icon: 'üè†'},
                {id: 'vehicles', name: 'Vehicles', icon: 'üöó'}
            ];
            
            // Sample locations
            const locations = [
                {id: 'Siachilaba', name: 'Siachilaba'},
                {id: 'Kariyangwe', name: 'Kariyangwe'},
                {id: 'Binga Centre', name: 'Binga Centre'},
                {id: 'Chete Island', name: 'Chete Island'},
                {id: 'Lake Kariba', name: 'Lake Kariba'},
                {id: 'Other', name: 'Other Areas'}
            ];
            
            // Sample attraction types
            const attractionTypes = [
                {id: 'beach', name: 'Beach'},
                {id: 'hotspring', name: 'Hot Spring'},
                {id: 'lake', name: 'Lake View'},
                {id: 'cultural', name: 'Cultural Site'},
                {id: 'wildlife', name: 'Wildlife'},
                {id: 'accommodation', name: 'Accommodation'},
                {id: 'tour', name: 'Tour Service'}
            ];
            
            // Sample tourist attractions
            const attractions = [
                {
                    id: 1,
                    name: 'Lake Kariba Shore',
                    description: 'Beautiful lakeside views and fishing spots with stunning sunsets over Africa\'s largest man-made lake. Perfect for fishing, boat rides, and photography.',
                    type: 'lake',
                    typeName: 'Lake View',
                    location: 'Lake Kariba',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Lake Kariba',
                    status: 'active',
                    addedBy: 1,
                    featured: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'Binga Hot Springs',
                    description: 'Natural hot springs with therapeutic properties, known for healing various ailments. Relax in warm mineral-rich waters surrounded by nature.',
                    type: 'hotspring',
                    typeName: 'Hot Spring',
                    location: 'Binga Centre',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Binga Hot Springs',
                    status: 'active',
                    addedBy: 1,
                    featured: true,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Sample products
            const products = [
                {
                    id: 1,
                    title: 'Fresh Kapenta - 20kg',
                    description: 'Freshly caught kapenta (small fish) from Lake Kariba. Good for business or family consumption. Sun-dried and preserved. Available weekly.',
                    category: 'fish',
                    price: 80,
                    location: 'Siachilaba',
                    sellerId: 2,
                    sellerName: 'John Fishing',
                    sellerPhone: '263773456789',
                    whatsappLink: 'https://wa.me/263773456789?text=Hi! I saw your Fresh Kapenta - 20kg on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    featured: true,
                    views: 45,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Local Goats - 3 Available',
                    description: 'Healthy local goats, 6-8 months old. Perfect for ceremonies or breeding. Grass-fed and well cared for. Can deliver within Binga.',
                    category: 'goat',
                    price: 60,
                    location: 'Kariyangwe',
                    sellerId: 3,
                    sellerName: 'Mary Livestock',
                    sellerPhone: '263774567890',
                    whatsappLink: 'https://wa.me/263774567890?text=Hi! I saw your Local Goats - 3 Available on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    featured: true,
                    views: 32,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Settings
            const settings = [
                {
                    id: 'site_settings',
                    siteName: 'Binga Marketplace',
                    adminPhone: '263772863815',
                    adminEmail: 'admin@bingamarket.co.zw',
                    maxFileSize: 50, // MB
                    maxFilesPerAd: 20,
                    autoApproveSellers: false,
                    currency: 'USD',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            
            // Add users
            users.forEach(user => {
                transaction.objectStore('users').add(user);
            });
            
            // Add categories
            categories.forEach(category => {
                transaction.objectStore('categories').add(category);
            });
            
            // Add locations
            locations.forEach(location => {
                transaction.objectStore('locations').add(location);
            });
            
            // Add attraction types
            attractionTypes.forEach(type => {
                transaction.objectStore('attractionTypes').add(type);
            });
            
            // Add attractions
            attractions.forEach(attraction => {
                transaction.objectStore('attractions').add(attraction);
            });
            
            // Add products
            products.forEach(product => {
                transaction.objectStore('products').add(product);
            });
            
            // Add settings
            settings.forEach(setting => {
                transaction.objectStore('settings').add(setting);
            });
            
            await transaction.complete;
            console.log('Sample data added to IndexedDB');
        }
        
        // Database operations
        const BINGA_MARKETPLACE_DB = {
            // User operations
            users: {
                async getAll() {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(user) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.add(user);
                        request.onsuccess = () => resolve(user);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const user = await this.get(id);
                    if (user) {
                        const updatedUser = {...user, ...updates};
                        const transaction = db.transaction(['users'], 'readwrite');
                        const store = transaction.objectStore('users');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedUser);
                            request.onsuccess = () => resolve(updatedUser);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async findByUsername(username) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const index = store.index('username');
                    return new Promise((resolve, reject) => {
                        const request = index.get(username);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getSellers() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'seller');
                },
                
                async getAdmins() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'admin');
                },
                
                async search(query) {
                    const users = await this.getAll();
                    if (!query) return users;
                    const q = query.toLowerCase();
                    return users.filter(u => 
                        u.name.toLowerCase().includes(q) ||
                        u.username.toLowerCase().includes(q) ||
                        u.phone.includes(q) ||
                        u.location.toLowerCase().includes(q)
                    );
                },
                
                async count() {
                    const users = await this.getAll();
                    return users.length;
                },
                
                async countSellers() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'seller').length;
                },
                
                async countPending() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'seller' && !u.approved).length;
                }
            },
            
            // Product operations
            products: {
                async getAll() {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(product) {
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.add(product);
                        request.onsuccess = () => resolve(product);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const product = await this.get(id);
                    if (product) {
                        const updatedProduct = {...product, ...updates};
                        const transaction = db.transaction(['products'], 'readwrite');
                        const store = transaction.objectStore('products');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedProduct);
                            request.onsuccess = () => resolve(updatedProduct);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // First, delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'product');
                    
                    // Then delete the product
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const products = await this.getAll();
                    const activeProducts = products.filter(p => p.status === 'active' && p.approved);
                    
                    // Sort by featured first, then by date
                    activeProducts.sort((a, b) => {
                        if (a.featured && !b.featured) return -1;
                        if (!a.featured && b.featured) return 1;
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    });
                    
                    if (limit) {
                        return activeProducts.slice(offset, offset + limit);
                    }
                    return activeProducts;
                },
                
                async getPending() {
                    const products = await this.getAll();
                    return products.filter(p => !p.approved || p.status === 'pending');
                },
                
                async getByCategory(category, limit = null, offset = 0) {
                    const products = await this.getAll();
                    const filtered = products.filter(p => p.category === category && p.status === 'active' && p.approved);
                    
                    filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    if (limit) {
                        return filtered.slice(offset, offset + limit);
                    }
                    return filtered;
                },
                
                async getBySeller(sellerId) {
                    const products = await this.getAll();
                    return products.filter(p => p.sellerId === sellerId)
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                },
                
                async count() {
                    const products = await this.getAll();
                    return products.length;
                },
                
                async countActive() {
                    const products = await this.getAll();
                    return products.filter(p => p.status === 'active' && p.approved).length;
                },
                
                async countPending() {
                    const products = await this.getAll();
                    return products.filter(p => !p.approved || p.status === 'pending').length;
                },
                
                async search(query, category = null, location = null, limit = 20, offset = 0) {
                    const products = await this.getAll();
                    let filtered = products.filter(p => p.status === 'active' && p.approved);
                    
                    if (query) {
                        const q = query.toLowerCase();
                        filtered = filtered.filter(p => 
                            p.title.toLowerCase().includes(q) || 
                            p.description.toLowerCase().includes(q) ||
                            p.category.toLowerCase().includes(q)
                        );
                    }
                    
                    if (category) {
                        filtered = filtered.filter(p => p.category === category);
                    }
                    
                    if (location) {
                        filtered = filtered.filter(p => p.location === location);
                    }
                    
                    // Sort by relevance or date
                    filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    return filtered.slice(offset, offset + limit);
                },
                
                async incrementViews(productId) {
                    const product = await this.get(productId);
                    if (product) {
                        product.views = (product.views || 0) + 1;
                        await this.update(productId, { views: product.views });
                    }
                },
                
                async deleteAll() {
                    const products = await this.getAll();
                    const transaction = db.transaction(['products', 'media'], 'readwrite');
                    const productsStore = transaction.objectStore('products');
                    const mediaStore = transaction.objectStore('media');
                    
                    // Delete all products
                    products.forEach(product => {
                        productsStore.delete(product.id);
                    });
                    
                    // Delete all product media
                    const media = await BINGA_MARKETPLACE_DB.media.getAll();
                    media.forEach(mediaItem => {
                        if (mediaItem.entityType === 'product') {
                            mediaStore.delete(mediaItem.id);
                        }
                    });
                    
                    await transaction.complete;
                    return true;
                }
            },
            
            // Tourist Attraction operations
            attractions: {
                async getAll() {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(attraction) {
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.add(attraction);
                        request.onsuccess = () => resolve(attraction);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const attraction = await this.get(id);
                    if (attraction) {
                        const updatedAttraction = {...attraction, ...updates};
                        const transaction = db.transaction(['attractions'], 'readwrite');
                        const store = transaction.objectStore('attractions');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedAttraction);
                            request.onsuccess = () => resolve(updatedAttraction);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // Delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'attraction');
                    
                    // Delete attraction
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const attractions = await this.getAll();
                    const active = attractions.filter(a => a.status === 'active');
                    
                    // Sort by featured first, then by date
                    active.sort((a, b) => {
                        if (a.featured && !b.featured) return -1;
                        if (!a.featured && b.featured) return 1;
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    });
                    
                    if (limit) {
                        return active.slice(offset, offset + limit);
                    }
                    return active;
                },
                
                async count() {
                    const attractions = await this.getAll();
                    return attractions.length;
                },
                
                async search(query) {
                    const attractions = await this.getAll();
                    if (!query) return attractions.filter(a => a.status === 'active');
                    const q = query.toLowerCase();
                    return attractions.filter(a => 
                        a.status === 'active' && (
                            a.name.toLowerCase().includes(q) ||
                            a.description.toLowerCase().includes(q) ||
                            a.type.toLowerCase().includes(q) ||
                            a.location.toLowerCase().includes(q)
                        )
                    );
                },
                
                async deleteAll() {
                    const attractions = await this.getAll();
                    const transaction = db.transaction(['attractions', 'media'], 'readwrite');
                    const attractionsStore = transaction.objectStore('attractions');
                    const mediaStore = transaction.objectStore('media');
                    
                    // Delete all attractions
                    attractions.forEach(attraction => {
                        attractionsStore.delete(attraction.id);
                    });
                    
                    // Delete all attraction media
                    const media = await BINGA_MARKETPLACE_DB.media.getAll();
                    media.forEach(mediaItem => {
                        if (mediaItem.entityType === 'attraction') {
                            mediaStore.delete(mediaItem.id);
                        }
                    });
                    
                    await transaction.complete;
                    return true;
                }
            },
            
            // Media operations
            media: {
                async getAll() {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(mediaItem) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.add(mediaItem);
                        request.onsuccess = () => resolve(mediaItem);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const mediaItem = await this.get(id);
                    if (mediaItem) {
                        const updatedMedia = {...mediaItem, ...updates};
                        const transaction = db.transaction(['media'], 'readwrite');
                        const store = transaction.objectStore('media');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedMedia);
                            request.onsuccess = () => resolve(updatedMedia);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getByEntity(entityId, entityType, limit = null, offset = 0) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    const index = store.index('entityId');
                    
                    return new Promise((resolve, reject) => {
                        const request = index.getAll(entityId);
                        request.onsuccess = () => {
                            let media = request.result.filter(m => m.entityType === entityType);
                            media.sort((a, b) => new Date(a.uploadedAt) - new Date(b.uploadedAt)); // Sort by upload date
                            
                            if (limit) {
                                media = media.slice(offset, offset + limit);
                            }
                            resolve(media);
                        };
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async deleteByEntity(entityId, entityType) {
                    const mediaItems = await this.getByEntity(entityId, entityType);
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    
                    return Promise.all(
                        mediaItems.map(item => 
                            new Promise((resolve, reject) => {
                                const request = store.delete(item.id);
                                request.onsuccess = () => resolve(true);
                                request.onerror = () => reject(request.error);
                            })
                        )
                    );
                },
                
                async count() {
                    const media = await this.getAll();
                    return media.length;
                },
                
                async countByEntity(entityId, entityType) {
                    const media = await this.getByEntity(entityId, entityType);
                    return media.length;
                },
                
                async getStorageStats() {
                    const media = await this.getAll();
                    let totalSize = 0;
                    
                    media.forEach(item => {
                        totalSize += item.size || 0;
                    });
                    
                    return {
                        count: media.length,
                        totalSize: totalSize,
                        formattedSize: formatBytes(totalSize)
                    };
                },
                
                async getTotalSize() {
                    const media = await this.getAll();
                    return media.reduce((sum, item) => sum + (item.size || 0), 0);
                },
                
                async deleteAll() {
                    const media = await this.getAll();
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    
                    media.forEach(item => {
                        store.delete(item.id);
                    });
                    
                    await transaction.complete;
                    return true;
                }
            },
            
            // Categories operations
            categories: {
                async getAll() {
                    const transaction = db.transaction(['categories'], 'readonly');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['categories'], 'readonly');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Locations operations
            locations: {
                async getAll() {
                    const transaction = db.transaction(['locations'], 'readonly');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Attraction Types operations
            attractionTypes: {
                async getAll() {
                    const transaction = db.transaction(['attractionTypes'], 'readonly');
                    const store = transaction.objectStore('attractionTypes');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Settings operations
            settings: {
                async get(id) {
                    const transaction = db.transaction(['settings'], 'readonly');
                    const store = transaction.objectStore('settings');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const setting = await this.get(id);
                    if (setting) {
                        const updatedSetting = {...setting, ...updates};
                        const transaction = db.transaction(['settings'], 'readwrite');
                        const store = transaction.objectStore('settings');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedSetting);
                            request.onsuccess = () => resolve(updatedSetting);
                            request.onerror = () => reject(request.error);
                        });
                    } else {
                        const transaction = db.transaction(['settings'], 'readwrite');
                        const store = transaction.objectStore('settings');
                        return new Promise((resolve, reject) => {
                            const request = store.add({id, ...updates});
                            request.onsuccess = () => resolve(updates);
                            request.onerror = () => reject(request.error);
                        });
                    }
                }
            },
            
            // Reports operations
            reports: {
                async getAll() {
                    const transaction = db.transaction(['reports'], 'readonly');
                    const store = transaction.objectStore('reports');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(report) {
                    const transaction = db.transaction(['reports'], 'readwrite');
                    const store = transaction.objectStore('reports');
                    return new Promise((resolve, reject) => {
                        const request = store.add(report);
                        request.onsuccess = () => resolve(report);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async delete(id) {
                    const transaction = db.transaction(['reports'], 'readwrite');
                    const store = transaction.objectStore('reports');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async count() {
                    const reports = await this.getAll();
                    return reports.length;
                }
            },
            
            // Logs operations
            logs: {
                async getAll() {
                    const transaction = db.transaction(['logs'], 'readonly');
                    const store = transaction.objectStore('logs');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(log) {
                    const transaction = db.transaction(['logs'], 'readwrite');
                    const store = transaction.objectStore('logs');
                    return new Promise((resolve, reject) => {
                        const request = store.add(log);
                        request.onsuccess = () => resolve(log);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async clearAll() {
                    const logs = await this.getAll();
                    const transaction = db.transaction(['logs'], 'readwrite');
                    const store = transaction.objectStore('logs');
                    
                    logs.forEach(log => {
                        store.delete(log.id);
                    });
                    
                    await transaction.complete;
                    return true;
                }
            }
        };
        
        // Utility function to format bytes
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
        }
        
        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // Show toast notification
        function showToast(message, type = 'info', duration = 5000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type === 'success' ? 'toast-success' : type === 'error' ? 'toast-error' : type === 'warning' ? 'toast-warning' : 'toast-info'}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // Show alert
        function showAlert(message, type = 'info') {
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type}`;
            alertEl.innerHTML = `
                ${message}
                <button class="alert-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            const mainContent = document.getElementById('mainContent');
            mainContent.insertBefore(alertEl, mainContent.firstChild);
            
            setTimeout(() => {
                if (alertEl.parentElement) {
                    alertEl.remove();
                }
            }, 5000);
        }
        
        // Add admin log
        async function addAdminLog(action, details = {}) {
            if (!currentUser || currentUser.type !== 'admin') return;
            
            const log = {
                id: Date.now(),
                userId: currentUser.id,
                username: currentUser.username,
                action: action,
                details: details,
                timestamp: new Date().toISOString(),
                ip: 'localhost' // In a real app, you'd get this from the server
            };
            
            try {
                await BINGA_MARKETPLACE_DB.logs.add(log);
            } catch (error) {
                console.error('Error adding admin log:', error);
            }
        }
        
        // Initialize the application
        async function initApp() {
            showLoading();
            try {
                // Initialize IndexedDB
                await initDB();
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('binga_current_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        // Verify user still exists in database
                        const userExists = await BINGA_MARKETPLACE_DB.users.get(currentUser.id);
                        if (userExists) {
                            currentUser = userExists;
                            localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                            updateAuthUI();
                            
                            // Add login log for admin
                            if (currentUser.type === 'admin') {
                                addAdminLog('admin_login', { method: 'auto_login' });
                            }
                        } else {
                            localStorage.removeItem('binga_current_user');
                            currentUser = null;
                            showAuthButtons();
                        }
                    } catch (e) {
                        localStorage.removeItem('binga_current_user');
                        currentUser = null;
                        showAuthButtons();
                    }
                } else {
                    showAuthButtons();
                }
                
                // Load initial data
                await loadInitialData();
                
                // Update storage stats
                await updateStorageStats();
                
                // Setup mobile menu toggle
                document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                    document.getElementById('navLinks').classList.toggle('show');
                });
                
                console.log('Application initialized successfully');
                showToast('Welcome to Binga Marketplace!', 'success', 3000);
            } catch (error) {
                console.error('Error initializing app:', error);
                showAlert('Error initializing application. Please refresh the page.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load initial data
        async function loadInitialData() {
            await loadMarketplace(1, 12);
            await loadTouristAttractions(1, 6);
            await loadCategories();
            await loadLocations();
            setActiveNav('home');
        }
        
        // Update storage statistics
        async function updateStorageStats() {
            try {
                const stats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
                const usedMB = (stats.totalSize / (1024 * 1024)).toFixed(2);
                const totalMB = 5000; // 5GB limit for IndexedDB
                const percentage = Math.min((usedMB / totalMB) * 100, 100);
                
                document.getElementById('storageUsed').textContent = `${usedMB} MB`;
                document.getElementById('storageTotal').textContent = `${totalMB} MB`;
                document.getElementById('storageBar').style.width = `${percentage}%`;
            } catch (error) {
                console.error('Error updating storage stats:', error);
            }
        }
        
        // Show auth buttons (only in top-right corner)
        function showAuthButtons() {
            document.getElementById('authButtons').innerHTML = `
                <button class="auth-btn login" onclick="openAuthModal('login', 'seller')">Seller Login</button>
                <button class="auth-btn register" onclick="openAuthModal('register')">Register as Seller</button>
            `;
            document.getElementById('userMenu').style.display = 'none';
            document.getElementById('authButtons').style.display = 'flex';
        }
        
        // Update auth UI after login
        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'flex';
                
                document.getElementById('userName').textContent = currentUser.name;
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                document.getElementById('userAvatar').textContent = initials || 'U';
                
                // Add admin class to avatar if admin
                if (currentUser.type === 'admin') {
                    document.getElementById('userAvatar').classList.add('admin');
                    document.getElementById('adminAccessBtn').style.display = 'inline-block';
                    document.getElementById('adminUsername').textContent = currentUser.username;
                } else {
                    document.getElementById('userAvatar').classList.remove('admin');
                    document.getElementById('adminAccessBtn').style.display = 'none';
                }
                
                if (document.getElementById('dashboardSection').style.display !== 'none') {
                    loadUserDashboard();
                }
                
                if (document.getElementById('adminSection').style.display !== 'none') {
                    loadAdminDashboard();
                }
            } else {
                showAuthButtons();
            }
        }
        
        // Load admin dashboard stats
        async function loadAdminDashboard() {
            if (!currentUser || currentUser.type !== 'admin') return;
            
            try {
                const totalProducts = await BINGA_MARKETPLACE_DB.products.count();
                const totalUsers = await BINGA_MARKETPLACE_DB.users.countSellers();
                const pendingApprovals = await BINGA_MARKETPLACE_DB.products.countPending();
                const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
                
                document.getElementById('totalProductsCount').textContent = totalProducts;
                document.getElementById('totalUsersCount').textContent = totalUsers;
                document.getElementById('pendingApprovalsCount').textContent = pendingApprovals;
                document.getElementById('totalAttractionsCount').textContent = totalAttractions;
                
                // Update badge counts
                document.getElementById('pendingBadge').textContent = pendingApprovals;
                document.getElementById('usersBadge').textContent = totalUsers;
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
            }
        }
        
        // Toggle user dropdown
        function toggleUserDropdown() {
            // This could be expanded to show a dropdown menu with options
            if (currentUser.type === 'admin') {
                showSection('admin');
            } else {
                showSection('dashboard');
            }
        }
        
        // Open auth modal
        function openAuthModal(form = 'login', type = 'seller') {
            loginType = type;
            const modal = document.getElementById('authModal');
            modal.style.display = 'flex';
            showAuthForm(form);
            setLoginType(type);
            
            // Clear form fields
            if (form === 'login') {
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }
        
        // Close auth modal
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }
        
        // Show login or register form
        function showAuthForm(form) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            if (form === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
                document.getElementById('loginTypeSelector').style.display = 'block';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
                document.getElementById('loginTypeSelector').style.display = 'none';
            }
        }
        
        // Set login type
        function setLoginType(type) {
            loginType = type;
            const buttons = document.querySelectorAll('.auth-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (type === 'seller') {
                buttons[0].classList.add('active');
                document.getElementById('loginTitle').textContent = 'Login to Seller Account';
                document.getElementById('loginLabel').textContent = 'Username';
                document.getElementById('loginEmail').placeholder = 'Enter your username';
            } else {
                buttons[1].classList.add('active');
                document.getElementById('loginTitle').textContent = 'Admin Login';
                document.getElementById('loginLabel').textContent = 'Admin Username';
                document.getElementById('loginEmail').placeholder = 'Enter admin username';
            }
        }
        
        // Login function
        async function login() {
            const username = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showToast('Please enter username and password', 'error');
                return;
            }
            
            showLoading();
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                let user = null;
                
                if (loginType === 'admin') {
                    // UPDATED: Admin login with new credentials
                    user = users.find(u => 
                        u.username === username && 
                        u.password === password &&
                        u.type === 'admin'
                    );
                    
                    if (!user) {
                        showToast('Invalid admin credentials. Username: Munkuli@1996, Password: PickGod', 'error');
                        return;
                    }
                } else {
                    user = users.find(u => 
                        u.username === username && 
                        u.password === password &&
                        u.type === 'seller'
                    );
                    
                    if (user && !user.approved) {
                        showToast('Your seller account is pending approval. Contact administrator at +263 77 286 3815', 'error');
                        return;
                    }
                }
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('binga_current_user', JSON.stringify(user));
                    updateAuthUI();
                    closeAuthModal();
                    
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    showToast(`Login successful! Welcome ${user.name}`, 'success');
                    
                    // Add login log for admin
                    if (user.type === 'admin') {
                        addAdminLog('admin_login', { method: 'manual_login' });
                    }
                    
                    if (user.type === 'seller' && user.justRegistered) {
                        setTimeout(() => {
                            showPostAdForm();
                            BINGA_MARKETPLACE_DB.users.update(user.id, { justRegistered: false });
                        }, 1000);
                    }
                    else if (user.type === 'admin') {
                        setTimeout(() => showSection('admin'), 500);
                    } else {
                        setTimeout(() => showSection('dashboard'), 500);
                    }
                } else {
                    if (loginType === 'admin') {
                        showToast('Invalid admin credentials. Username: Munkuli@1996, Password: PickGod', 'error');
                    } else {
                        showToast('Invalid credentials. Please check your username and password.', 'error');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Error during login. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Register function
        async function register() {
            const name = document.getElementById('registerName').value.trim();
            const phone = document.getElementById('registerPhone').value.replace(/\D/g, '');
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const location = document.getElementById('registerLocation').value;
            
            if (!name || !phone || !username || !password || !confirmPassword || !location) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (phone.length < 9 || !phone.startsWith('263')) {
                showToast('Please enter a valid Zimbabwean phone number starting with 263', 'error');
                return;
            }
            
            if (username.length < 3) {
                showToast('Username must be at least 3 characters long', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters long', 'error');
                return;
            }
            
            showLoading();
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                
                if (users.find(u => u.username === username)) {
                    showToast('Username already taken. Please choose another one.', 'error');
                    return;
                }
                
                if (users.find(u => u.phone === phone)) {
                    showToast('Phone number already registered', 'error');
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    phone: phone,
                    email: '',
                    location: location,
                    type: 'seller',
                    justRegistered: true,
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 0,
                    approved: true, // Auto-approve for demo
                    status: 'active'
                };
                
                await BINGA_MARKETPLACE_DB.users.add(newUser);
                
                showToast('Registration successful! You can now login with your username and password.', 'success');
                
                document.getElementById('registerName').value = '';
                document.getElementById('registerPhone').value = '';
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerConfirmPassword').value = '';
                document.getElementById('registerLocation').value = '';
                
                showAuthForm('login');
                setLoginType('seller');
                document.getElementById('loginEmail').value = username;
                document.getElementById('loginPassword').focus();
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Error during registration. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Add logout log for admin
                if (currentUser && currentUser.type === 'admin') {
                    addAdminLog('admin_logout', {});
                }
                
                currentUser = null;
                localStorage.removeItem('binga_current_user');
                showAuthButtons();
                showSection('home');
                showToast('Logged out successfully', 'success');
            }
        }
        
        // Load marketplace products with pagination
        async function loadMarketplace(page = 1, limit = 12) {
            showLoading();
            try {
                const offset = (page - 1) * limit;
                const products = await BINGA_MARKETPLACE_DB.products.getActive(limit, offset);
                const totalProducts = await BINGA_MARKETPLACE_DB.products.countActive();
                const totalPages = Math.ceil(totalProducts / limit);
                
                const featuredContainer = document.getElementById('featuredProducts');
                const message = document.getElementById('marketplaceMessage');
                const recentContainer = document.getElementById('recentProducts');
                const recentMessage = document.getElementById('recentProductsMessage');
                const recentProducts = await BINGA_MARKETPLACE_DB.products.getActive(6, 0);
                
                if (products.length === 0) {
                    message.style.display = 'block';
                    featuredContainer.style.display = 'none';
                    recentMessage.style.display = 'block';
                    recentContainer.style.display = 'none';
                    document.getElementById('featuredPagination').style.display = 'none';
                    document.getElementById('recentPagination').style.display = 'none';
                    return;
                }
                
                message.style.display = 'none';
                recentMessage.style.display = 'none';
                
                // Display featured products
                featuredContainer.style.display = 'grid';
                featuredContainer.innerHTML = await Promise.all(
                    products.map(product => renderProductCard(product))
                );
                
                // Display recent products
                recentContainer.style.display = 'grid';
                recentContainer.innerHTML = await Promise.all(
                    recentProducts.map(product => renderProductCard(product))
                );
                
                // Add pagination if needed
                if (totalPages > 1) {
                    renderPagination('featuredPagination', page, totalPages, loadMarketplace);
                    document.getElementById('featuredPagination').style.display = 'flex';
                } else {
                    document.getElementById('featuredPagination').style.display = 'none';
                }
                
                // Add pagination for recent products if needed
                if (totalProducts > 6) {
                    renderPagination('recentPagination', 1, Math.ceil(totalProducts / 6), (page) => {
                        loadRecentProducts(page, 6);
                    });
                    document.getElementById('recentPagination').style.display = 'flex';
                } else {
                    document.getElementById('recentPagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading marketplace:', error);
                showToast('Error loading marketplace products', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load recent products with pagination
        async function loadRecentProducts(page = 1, limit = 6) {
            showLoading();
            try {
                const offset = (page - 1) * limit;
                const products = await BINGA_MARKETPLACE_DB.products.getActive(limit, offset);
                const recentContainer = document.getElementById('recentProducts');
                
                if (products.length > 0) {
                    recentContainer.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                }
            } catch (error) {
                console.error('Error loading recent products:', error);
                showToast('Error loading recent products', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load tourist attractions with pagination
        async function loadTouristAttractions(page = 1, limit = 6) {
            showLoading();
            try {
                const offset = (page - 1) * limit;
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getActive(limit, offset);
                const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
                const totalPages = Math.ceil(totalAttractions / limit);
                
                const container = document.getElementById('touristAttractions');
                const message = document.getElementById('noAttractionsMessage');
                
                if (attractions.length === 0) {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    document.getElementById('touristPagination').style.display = 'none';
                    return;
                }
                
                container.style.display = 'grid';
                message.style.display = 'none';
                container.innerHTML = await Promise.all(
                    attractions.map(attraction => renderAttractionCard(attraction))
                );
                
                // Add pagination if needed
                if (totalPages > 1) {
                    renderPagination('touristPagination', page, totalPages, loadTouristAttractions);
                    document.getElementById('touristPagination').style.display = 'flex';
                } else {
                    document.getElementById('touristPagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading tourist attractions:', error);
                showToast('Error loading tourist attractions', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Render product card
        async function renderProductCard(product) {
            const categoryIcons = {
                'fish': 'üêü',
                'goat': 'üêê',
                'cow': 'üêÑ',
                'poultry': 'üêì',
                'agriculture': 'üåæ',
                'tourism': 'üèûÔ∏è',
                'services': 'üîß',
                'property': 'üè†',
                'vehicles': 'üöó'
            };
            
            const icon = categoryIcons[product.category] || 'üì¶';
            
            // Get media for this product
            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(product.id, 'product', 1, 0);
            const hasMedia = media && media.length > 0;
            const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(product.id, 'product');
            
            let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
            let mediaBadge = '';
            
            if (hasMedia) {
                const firstMedia = media[0];
                if (firstMedia.mediaType === 'image') {
                    mediaElement = `<img src="${firstMedia.dataUrl}" alt="${product.title}" loading="lazy" onclick="openMediaGallery(${product.id}, 'product')">`;
                } else if (firstMedia.mediaType === 'video') {
                    mediaElement = `
                        <video onclick="openMediaGallery(${product.id}, 'product')" preload="metadata">
                            <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                        </video>
                        <div class="file-type-badge">VIDEO</div>
                    `;
                }
                
                if (mediaCount > 1) {
                    mediaBadge = `<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px; backdrop-filter: blur(5px);">
                        <i class="fas fa-camera"></i> ${mediaCount}
                    </div>`;
                }
            }
            
            return `
                <div class="product-card">
                    <div class="product-image">
                        ${mediaElement}
                        ${mediaBadge}
                        <div class="product-price">$${product.price}</div>
                    </div>
                    <div class="product-details">
                        <h3 class="product-title">
                            ${product.title}
                            ${product.featured ? '<span style="color: var(--warning); font-size: 12px;">‚≠ê Featured</span>' : ''}
                        </h3>
                        <p class="product-meta">${product.description.substring(0, 80)}${product.description.length > 80 ? '...' : ''}</p>
                        <div class="product-location">
                            <i class="fas fa-map-marker-alt"></i> ${product.location} ‚Ä¢ <i class="fas fa-eye"></i> ${product.views || 0}
                        </div>
                        <a href="${product.whatsappLink}" target="_blank" class="whatsapp-btn" onclick="incrementProductViews(${product.id})">
                            <i class="fab fa-whatsapp"></i> Contact Seller
                        </a>
                    </div>
                </div>
            `;
        }
        
        // Increment product views when WhatsApp button is clicked
        async function incrementProductViews(productId) {
            try {
                await BINGA_MARKETPLACE_DB.products.incrementViews(productId);
            } catch (error) {
                console.error('Error incrementing views:', error);
            }
        }
        
        // Render tourist attraction card
        async function renderAttractionCard(attraction) {
            const attractionIcons = {
                'beach': 'üèñÔ∏è',
                'hotspring': '‚ô®Ô∏è',
                'lake': 'üåä',
                'cultural': 'üèõÔ∏è',
                'wildlife': 'üêò',
                'accommodation': 'üè®',
                'tour': 'üö£'
            };
            
            const icon = attractionIcons[attraction.type] || 'üèûÔ∏è';
            
            // Get media for this attraction
            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(attraction.id, 'attraction', 1, 0);
            const hasMedia = media && media.length > 0;
            const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(attraction.id, 'attraction');
            
            let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
            let mediaBadge = '';
            
            if (hasMedia) {
                const firstMedia = media[0];
                if (firstMedia.mediaType === 'image') {
                    mediaElement = `<img src="${firstMedia.dataUrl}" alt="${attraction.name}" loading="lazy" onclick="openMediaGallery(${attraction.id}, 'attraction')">`;
                } else if (firstMedia.mediaType === 'video') {
                    mediaElement = `
                        <video onclick="openMediaGallery(${attraction.id}, 'attraction')" preload="metadata">
                            <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                        </video>
                        <div class="file-type-badge">VIDEO</div>
                    `;
                }
                
                if (mediaCount > 1) {
                    mediaBadge = `<div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px; backdrop-filter: blur(5px);">
                        <i class="fas fa-camera"></i> ${mediaCount}
                    </div>`;
                }
            }
            
            return `
                <div class="attraction-card">
                    <div class="attraction-image">
                        ${mediaElement}
                        ${mediaBadge}
                        <div class="attraction-type">${attraction.typeName || attraction.type}</div>
                    </div>
                    <div class="product-details">
                        <h3 class="product-title">
                            ${attraction.name}
                            ${attraction.featured ? '<span style="color: var(--warning); font-size: 12px;">‚≠ê Featured</span>' : ''}
                        </h3>
                        <p class="product-meta">${attraction.description.substring(0, 100)}${attraction.description.length > 100 ? '...' : ''}</p>
                        <div class="product-location">
                            <i class="fas fa-map-marker-alt"></i> ${attraction.location}
                        </div>
                        <div style="margin-top: 10px;">
                            <a href="${attraction.whatsappLink}" target="_blank" class="whatsapp-btn" style="background: var(--tourist);">
                                <i class="fab fa-whatsapp"></i> Book on WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Open media gallery
        async function openMediaGallery(entityId, entityType) {
            showLoading();
            try {
                currentMediaItems = await BINGA_MARKETPLACE_DB.media.getByEntity(entityId, entityType);
                
                if (currentMediaItems.length === 0) {
                    showToast('No media available for this item', 'error');
                    return;
                }
                
                currentMediaIndex = 0;
                const modal = document.getElementById('mediaModal');
                const slider = document.getElementById('mediaSlider');
                const thumbnails = document.getElementById('mediaThumbnails');
                
                // Clear existing content
                slider.innerHTML = '';
                thumbnails.innerHTML = '';
                
                // Create media slides
                currentMediaItems.forEach((media, index) => {
                    const slide = document.createElement('div');
                    slide.className = `media-slide ${index === 0 ? 'active' : ''}`;
                    
                    if (media.mediaType === 'image') {
                        slide.innerHTML = `<img src="${media.dataUrl}" alt="Media ${index + 1}" loading="lazy">`;
                    } else if (media.mediaType === 'video') {
                        slide.innerHTML = `
                            <video controls autoplay>
                                <source src="${media.dataUrl}" type="${media.mimeType}">
                            </video>
                        `;
                    }
                    
                    slider.appendChild(slide);
                    
                    // Create thumbnail
                    const thumb = document.createElement('div');
                    thumb.className = `media-thumb ${index === 0 ? 'active' : ''}`;
                    thumb.onclick = () => showMedia(index);
                    
                    if (media.mediaType === 'image') {
                        thumb.innerHTML = `<img src="${media.dataUrl}" alt="Thumbnail ${index + 1}" loading="lazy">`;
                    } else if (media.mediaType === 'video') {
                        thumb.innerHTML = `
                            <video>
                                <source src="${media.dataUrl}" type="${media.mimeType}">
                            </video>
                            <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px; backdrop-filter: blur(5px);">
                                <i class="fas fa-play"></i>
                            </div>
                        `;
                    }
                    
                    thumbnails.appendChild(thumb);
                });
                
                // Update counter
                updateMediaCounter();
                
                // Show modal
                modal.style.display = 'flex';
            } catch (error) {
                console.error('Error opening media gallery:', error);
                showToast('Error loading media', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Show specific media in gallery
        function showMedia(index) {
            const slides = document.querySelectorAll('.media-slide');
            const thumbs = document.querySelectorAll('.media-thumb');
            
            // Pause all videos
            document.querySelectorAll('video').forEach(video => {
                video.pause();
            });
            
            slides.forEach(slide => slide.classList.remove('active'));
            thumbs.forEach(thumb => thumb.classList.remove('active'));
            
            slides[index].classList.add('active');
            thumbs[index].classList.add('active');
            currentMediaIndex = index;
            
            updateMediaCounter();
        }
        
        // Next media in gallery
        function nextMedia() {
            if (currentMediaItems.length === 0) return;
            
            // Pause current video
            const currentSlide = document.querySelector('.media-slide.active');
            const currentVideo = currentSlide.querySelector('video');
            if (currentVideo) {
                currentVideo.pause();
            }
            
            currentMediaIndex = (currentMediaIndex + 1) % currentMediaItems.length;
            showMedia(currentMediaIndex);
        }
        
        // Previous media in gallery
        function prevMedia() {
            if (currentMediaItems.length === 0) return;
            
            // Pause current video
            const currentSlide = document.querySelector('.media-slide.active');
            const currentVideo = currentSlide.querySelector('video');
            if (currentVideo) {
                currentVideo.pause();
            }
            
            currentMediaIndex = (currentMediaIndex - 1 + currentMediaItems.length) % currentMediaItems.length;
            showMedia(currentMediaIndex);
        }
        
        // Update media counter
        function updateMediaCounter() {
            document.getElementById('mediaCounter').textContent = 
                `${currentMediaIndex + 1} / ${currentMediaItems.length}`;
        }
        
        // Close media gallery
        function closeMediaModal() {
            // Pause all videos before closing
            document.querySelectorAll('video').forEach(video => {
                video.pause();
            });
            
            document.getElementById('mediaModal').style.display = 'none';
            currentMediaItems = [];
            currentMediaIndex = 0;
        }
        
        // Load categories with counts
        async function loadCategories() {
            try {
                const categories = await BINGA_MARKETPLACE_DB.categories.getAll();
                const activeProducts = await BINGA_MARKETPLACE_DB.products.getActive();
                
                const container = document.getElementById('categoryList');
                container.innerHTML = categories.map(cat => {
                    const count = activeProducts.filter(p => p.category === cat.id).length;
                    return `
                        <li class="category-item">
                            <a href="#" onclick="showCategory('${cat.id}')">
                                ${cat.icon} ${cat.name}
                                <span class="category-count">${count}</span>
                            </a>
                        </li>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Load locations with counts
        async function loadLocations() {
            try {
                const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
                const activeProducts = await BINGA_MARKETPLACE_DB.products.getActive();
                
                const container = document.getElementById('locationList');
                container.innerHTML = locations.map(loc => {
                    const count = activeProducts.filter(p => p.location === loc.id).length;
                    return `
                        <li class="location-item">
                            <a href="#" onclick="showLocation('${loc.id}')">
                                ${loc.name}
                                <span class="location-count">${count}</span>
                            </a>
                        </li>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading locations:', error);
            }
        }
        
        // Show section
        function showSection(section) {
            // Hide mobile menu on mobile
            if (window.innerWidth <= 768) {
                document.getElementById('navLinks').classList.remove('show');
            }
            
            // Hide all sections
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('tourismSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('postAdSection').style.display = 'none';
            document.getElementById('addAttractionSection').style.display = 'none';
            document.getElementById('editAttractionSection').style.display = 'none';
            
            // Show selected section
            if (section === 'home') {
                document.getElementById('homeSection').style.display = 'block';
                loadMarketplace(1, 12);
                loadTouristAttractions(1, 6);
            } else if (section === 'tourism') {
                document.getElementById('tourismSection').style.display = 'block';
                loadTourismContent();
            } else if (section === 'dashboard') {
                if (!currentUser || currentUser.type !== 'seller') {
                    openAuthModal('login', 'seller');
                    return;
                }
                document.getElementById('dashboardSection').style.display = 'block';
                loadUserDashboard();
            } else if (section === 'admin') {
                if (!currentUser || currentUser.type !== 'admin') {
                    openAuthModal('login', 'admin');
                    return;
                }
                document.getElementById('adminSection').style.display = 'block';
                showAdminTab('pending');
                loadAdminDashboard();
            } else {
                document.getElementById('homeSection').style.display = 'block';
                filterProductsByCategory(section);
            }
            
            setActiveNav(section);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Set active navigation
        function setActiveNav(section) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            for (let link of navLinks) {
                if (link.textContent.toLowerCase().includes(section.toLowerCase()) || 
                    (section === 'home' && link.classList.contains('active'))) {
                    link.classList.add('active');
                    break;
                }
            }
            
            if (section === 'tourism') {
                document.querySelector('.nav-link.tourist').classList.add('active');
            }
        }
        
        // Filter products by category
        async function filterProductsByCategory(category) {
            showLoading();
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getByCategory(category, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                const categoryNames = {
                    'fish': 'Fish & Seafood',
                    'goat': 'Goats',
                    'cow': 'Cattle',
                    'poultry': 'Poultry',
                    'agriculture': 'Agricultural Products',
                    'tourism': 'Tourism Services',
                    'services': 'Services',
                    'property': 'Property',
                    'vehicles': 'Vehicles'
                };
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-tag"></i> ${categoryNames[category] || category} (${products.length})
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üè∑Ô∏è</div>
                        <h3>No products in ${categoryNames[category] || category} category</h3>
                        <p>Be the first to post in this category!</p>
                        ${currentUser && currentUser.type === 'seller' ? 
                            `<button class="btn btn-primary" onclick="showPostAdForm()" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Post an Ad
                            </button>` : 
                            `<button class="btn btn-primary" onclick="openAuthModal('login', 'seller')" style="margin-top: 15px;">
                                <i class="fas fa-sign-in-alt"></i> Login as Seller
                            </button>`
                        }
                    `;
                }
                
                // Hide featured products grid when viewing category
                document.getElementById('featuredProducts').style.display = 'none';
                document.getElementById('marketplaceMessage').style.display = 'none';
                document.getElementById('featuredPagination').style.display = 'none';
            } catch (error) {
                console.error('Error filtering products:', error);
                showToast('Error loading category products', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Show category
        function showCategory(categoryId) {
            showSection('home');
            filterProductsByCategory(categoryId);
            setActiveNav(categoryId);
        }
        
        // Show location
        async function showLocation(locationId) {
            showLoading();
            try {
                const products = await BINGA_MARKETPLACE_DB.products.search('', null, locationId, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-map-marker-alt"></i> Products in ${locationId} (${products.length})
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üìç</div>
                        <h3>No products in ${locationId}</h3>
                        <p>Be the first to post in this location!</p>
                    `;
                }
                
                // Hide featured products grid when viewing location
                document.getElementById('featuredProducts').style.display = 'none';
                document.getElementById('marketplaceMessage').style.display = 'none';
                document.getElementById('featuredPagination').style.display = 'none';
            } catch (error) {
                console.error('Error showing location:', error);
                showToast('Error loading location products', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Search products
        async function searchProducts() {
            const query = document.getElementById('searchInput').value;
            const category = document.getElementById('categorySelect').value;
            const location = document.getElementById('locationSelect').value;
            
            if (!query && !category && !location) {
                showToast('Please enter search criteria', 'error');
                return;
            }
            
            showLoading();
            try {
                const products = await BINGA_MARKETPLACE_DB.products.search(query, category || null, location || null, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    let title = 'Search Results';
                    if (query || category || location) {
                        title = `${products.length} Product(s) Found`;
                        if (query) title += ` for "${query}"`;
                    }
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-search"></i> ${title}
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üîç</div>
                        <h3>No products found</h3>
                        <p>Try different search terms or filters</p>
                    `;
                }
                
                // Hide featured products grid when searching
                document.getElementById('featuredProducts').style.display = 'none';
                document.getElementById('marketplaceMessage').style.display = 'none';
                document.getElementById('featuredPagination').style.display = 'none';
            } catch (error) {
                console.error('Error searching products:', error);
                showToast('Error searching products', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Show post ad form
        function showPostAdForm() {
            if (!currentUser || currentUser.type !== 'seller') {
                openAuthModal('login', 'seller');
                return;
            }
            
            uploadedMedia = [];
            
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('tourismSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('addAttractionSection').style.display = 'none';
            document.getElementById('editAttractionSection').style.display = 'none';
            
            document.getElementById('postAdSection').style.display = 'block';
            
            document.getElementById('postAdForm').innerHTML = `
                <form id="adForm">
                    <div class="form-group">
                        <label class="form-label">Ad Title*</label>
                        <input type="text" class="form-control" id="adTitle" placeholder="e.g., Fresh Kapenta - 20kg" required>
                        <small style="color: #666;">Make it descriptive to attract buyers</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category*</label>
                        <select class="form-control" id="adCategory" required>
                            <option value="">Select Category</option>
                            <option value="fish">Fish & Seafood</option>
                            <option value="goat">Goats</option>
                            <option value="cow">Cattle</option>
                            <option value="poultry">Poultry</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="services">Services</option>
                            <option value="property">Property</option>
                            <option value="vehicles">Vehicles</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Price (USD)*</label>
                        <input type="number" class="form-control" id="adPrice" placeholder="e.g., 80" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location in Binga*</label>
                        <select class="form-control" id="adLocation" required>
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Lake Kariba</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="adDescription" rows="4" placeholder="Describe your product or service..." required></textarea>
                        <small style="color: #666;">Include details like size, weight, condition, etc.</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact Phone*</label>
                        <input type="tel" class="form-control" id="adPhone" value="${currentUser.phone}" required>
                        <small style="color: #666;">Buyers will contact you on this number via WhatsApp</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Upload Photos & Videos</label>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <p><strong>Tips for better sales:</strong></p>
                            <ul style="margin-left: 20px; color: #666;">
                                <li>Upload clear photos in good daylight</li>
                                <li>Show product from different angles</li>
                                <li>Videos help buyers see details</li>
                                <li>First image will be the cover photo</li>
                                <li>Files are automatically compressed</li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label for="mediaUpload" class="image-upload-btn">
                                <i class="fas fa-upload"></i> Upload Photos & Videos
                            </label>
                            <input type="file" id="mediaUpload" accept="image/*,video/*" multiple onchange="handleMediaUpload(event)" style="display: none;">
                            
                            <button type="button" class="batch-upload-btn" onclick="document.getElementById('mediaUpload').click()">
                                <i class="fas fa-folder-open"></i> Batch Upload
                            </button>
                            
                            ${navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? 
                                `<button type="button" class="camera-btn" onclick="openCamera()">
                                    <i class="fas fa-camera"></i> Take Photo/Video
                                </button>` : ''
                            }
                        </div>
                        
                        <div class="upload-progress" id="uploadProgress">
                            <div class="upload-progress-bar" id="uploadProgressBar"></div>
                        </div>
                        
                        <div class="image-upload-container" id="mediaPreviewContainer">
                            <!-- Media previews will appear here -->
                        </div>
                        
                        <div id="uploadStatus" style="margin-top: 10px; font-size: 14px; color: #666;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Note to Administrator</label>
                        <textarea class="form-control" id="adNote" rows="2" placeholder="Any special notes for admin review..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-primary" onclick="submitAd()">
                            <i class="fas fa-paper-plane"></i> Submit for Approval
                        </button>
                        
                        <button type="button" class="btn" onclick="showSection('dashboard')" style="background: #f0f0f0;">
                            Cancel
                        </button>
                    </div>
                    
                    <p style="margin-top: 20px; color: #666; font-size: 14px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <i class="fas fa-info-circle"></i> <strong>Important:</strong> All ads require administrator approval before appearing on marketplace.
                        Contact +263 77 286 3815 for faster approval.
                    </p>
                </form>
            `;
            
            updateMediaPreviews();
        }
        
        // Handle media upload
        async function handleMediaUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            // Check total size limit (50MB per file, 5GB total)
            const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
            const largeFiles = files.filter(f => f.size > MAX_FILE_SIZE);
            if (largeFiles.length > 0) {
                showToast(`Some files exceed 50MB limit and will be skipped`, 'error');
            }
            
            const validFiles = files.filter(f => f.size <= MAX_FILE_SIZE);
            if (validFiles.length === 0) return;
            
            // Check total storage limit
            const currentStorage = await BINGA_MARKETPLACE_DB.media.getTotalSize();
            const additionalSize = validFiles.reduce((sum, f) => sum + f.size, 0);
            const MAX_STORAGE = 5 * 1024 * 1024 * 1024; // 5GB
            
            if (currentStorage + additionalSize > MAX_STORAGE) {
                showToast('Storage limit exceeded. Please delete some media first.', 'error');
                return;
            }
            
            isUploading = true;
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('uploadProgressBar');
            const status = document.getElementById('uploadStatus');
            
            progressBar.style.display = 'block';
            status.textContent = `Processing ${validFiles.length} file(s)...`;
            status.style.color = '#666';
            
            let processedCount = 0;
            let errors = [];
            
            for (const file of validFiles) {
                try {
                    await processMediaFile(file);
                    processedCount++;
                    
                    progressFill.style.width = `${(processedCount / validFiles.length) * 100}%`;
                    status.textContent = `Processed ${processedCount} of ${validFiles.length} files...`;
                } catch (error) {
                    console.error('Error processing file:', error);
                    errors.push(file.name);
                }
            }
            
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                
                if (errors.length > 0) {
                    status.textContent = `Uploaded ${processedCount} files, ${errors.length} failed`;
                    status.style.color = 'var(--danger)';
                } else {
                    status.textContent = `Successfully uploaded ${processedCount} file(s)!`;
                    status.style.color = 'var(--accent)';
                }
                
                isUploading = false;
                updateStorageStats();
                
                // Clear file input
                event.target.value = '';
            }, 500);
        }
        
        // Process media file
        async function processMediaFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    try {
                        const isImage = file.type.startsWith('image/');
                        const isVideo = file.type.startsWith('video/');
                        
                        if (!isImage && !isVideo) {
                            reject(new Error(`Unsupported file type: ${file.type}`));
                            return;
                        }
                        
                        // Compress image if it's an image
                        let dataUrl = e.target.result;
                        let size = file.size;
                        
                        if (isImage) {
                            try {
                                dataUrl = await compressImage(dataUrl, file.type);
                                size = Math.floor(dataUrl.length * 0.75); // Approximate size
                            } catch (compressError) {
                                console.warn('Image compression failed, using original:', compressError);
                            }
                        }
                        
                        const mediaItem = {
                            id: Date.now() + Math.random(),
                            entityId: null, // Will be set when product/attraction is created
                            entityType: 'product', // Default, can be changed for attractions
                            mediaType: isImage ? 'image' : 'video',
                            mimeType: file.type,
                            dataUrl: dataUrl,
                            size: size,
                            filename: file.name,
                            uploadedAt: new Date().toISOString(),
                            uploadedBy: currentUser ? currentUser.id : null
                        };
                        
                        uploadedMedia.push(mediaItem);
                        updateMediaPreviews();
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => {
                    reject(new Error(`Error reading ${file.name}`));
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // Compress image
        async function compressImage(dataUrl, mimeType, quality = 0.8, maxWidth = 1200) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Set background for transparent images
                    if (mimeType === 'image/png') {
                        ctx.fillStyle = 'white';
                        ctx.fillRect(0, 0, width, height);
                    }
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Adjust quality based on file type
                    let outputQuality = quality;
                    if (mimeType === 'image/jpeg') {
                        outputQuality = Math.min(quality, 0.9); // JPEG max quality 0.9
                    }
                    
                    const compressedDataUrl = canvas.toDataURL(mimeType, outputQuality);
                    resolve(compressedDataUrl);
                };
                
                img.onerror = reject;
                img.src = dataUrl;
            });
        }
        
        // Update media previews
        function updateMediaPreviews() {
            const container = document.getElementById('mediaPreviewContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            uploadedMedia.forEach((media, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                
                if (media.mediaType === 'image') {
                    previewDiv.innerHTML = `<img src="${media.dataUrl}" alt="Preview ${index + 1}" loading="lazy">`;
                } else if (media.mediaType === 'video') {
                    previewDiv.innerHTML = `
                        <video preload="metadata">
                            <source src="${media.dataUrl}" type="${media.mimeType}">
                        </video>
                        <div style="position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px; backdrop-filter: blur(5px);">
                            <i class="fas fa-play"></i> Video
                        </div>
                    `;
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-image';
                removeBtn.innerHTML = '√ó';
                removeBtn.onclick = function() {
                    uploadedMedia.splice(index, 1);
                    updateMediaPreviews();
                    updateStorageStats();
                };
                
                previewDiv.appendChild(removeBtn);
                container.appendChild(previewDiv);
            });
            
            // Add placeholder for adding more media
            if (uploadedMedia.length < 20) { // Reasonable limit
                const placeholder = document.createElement('div');
                placeholder.className = 'image-preview';
                placeholder.style.display = 'flex';
                placeholder.style.flexDirection = 'column';
                placeholder.style.alignItems = 'center';
                placeholder.style.justifyContent: 'center';
                placeholder.style.cursor = 'pointer';
                placeholder.innerHTML = `
                    <i class="fas fa-plus" style="font-size: 24px; color: #999; margin-bottom: 5px;"></i>
                    <div style="font-size: 12px; color: #999; text-align: center;">Add More<br>(${uploadedMedia.length} uploaded)</div>
                `;
                placeholder.onclick = function() {
                    document.getElementById('mediaUpload').click();
                };
                container.appendChild(placeholder);
            }
        }
        
        // Open camera
        function openCamera() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showToast('Camera not supported on this device', 'error');
                return;
            }
            
            showToast('Camera feature coming soon! Use upload button for now.', 'info');
        }
        
        // Submit ad
        async function submitAd() {
            const title = document.getElementById('adTitle').value.trim();
            const category = document.getElementById('adCategory').value;
            const price = document.getElementById('adPrice').value;
            const location = document.getElementById('adLocation').value;
            const description = document.getElementById('adDescription').value.trim();
            const phone = document.getElementById('adPhone').value.replace(/\D/g, '');
            const note = document.getElementById('adNote').value.trim();
            
            if (!title || !category || !price || !location || !description || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (phone.length < 9 || !phone.startsWith('263')) {
                showToast('Please enter a valid Zimbabwean phone number starting with 263', 'error');
                return;
            }
            
            const priceNum = parseFloat(price);
            if (isNaN(priceNum) || priceNum < 0) {
                showToast('Please enter a valid price', 'error');
                return;
            }
            
            if (uploadedMedia.length === 0 && !confirm('You haven\'t uploaded any photos or videos. Products with media sell 5x faster! Continue without media?')) {
                return;
            }
            
            const whatsappLink = `https://wa.me/${phone}?text=Hi! I saw your ${encodeURIComponent(title)} on Binga Marketplace`;
            
            const product = {
                id: Date.now(),
                title: title,
                description: description + (note ? `\n\nNote: ${note}` : ''),
                category: category,
                price: priceNum,
                location: location,
                sellerId: currentUser.id,
                sellerName: currentUser.name,
                sellerPhone: phone,
                whatsappLink: whatsappLink,
                status: 'pending',
                approved: false,
                featured: false,
                views: 0,
                createdAt: new Date().toISOString(),
                adminNote: note || ''
            };
            
            showLoading();
            try {
                // Save product
                await BINGA_MARKETPLACE_DB.products.add(product);
                
                // Save media
                if (uploadedMedia.length > 0) {
                    for (const media of uploadedMedia) {
                        media.entityId = product.id;
                        await BINGA_MARKETPLACE_DB.media.add(media);
                    }
                }
                
                // Update user
                const user = await BINGA_MARKETPLACE_DB.users.get(currentUser.id);
                if (user) {
                    user.products = [...(user.products || []), product.id];
                    await BINGA_MARKETPLACE_DB.users.update(user.id, user);
                    currentUser = user;
                    localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                }
                
                showToast('Ad submitted for approval! Administrator will review it shortly. Contact +263 77 286 3815 for faster approval.', 'success');
                
                // Clear form
                uploadedMedia = [];
                
                // Go to dashboard
                showSection('dashboard');
                updateStorageStats();
            } catch (error) {
                console.error('Error submitting ad:', error);
                showToast('Error submitting ad. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load user dashboard
        async function loadUserDashboard() {
            if (!currentUser) return;
            
            showLoading();
            try {
                const myProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(currentUser.id);
                const pendingProducts = myProducts.filter(p => !p.approved || p.status === 'pending');
                const activeProducts = myProducts.filter(p => p.status === 'active' && p.approved);
                const totalViews = myProducts.reduce((sum, p) => sum + (p.views || 0), 0);
                
                document.getElementById('myProductsCount').textContent = myProducts.length;
                document.getElementById('myViewsCount').textContent = totalViews;
                document.getElementById('myPendingCount').textContent = pendingProducts.length;
                document.getElementById('myActiveCount').textContent = activeProducts.length;
                
                const container = document.getElementById('userDashboard');
                container.innerHTML = `
                    <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showPostAdForm()">
                            <i class="fas fa-plus-circle"></i> Post New Ad
                        </button>
                        <button class="btn" style="background: var(--tourist); color: white;" onclick="showSection('tourism')">
                            <i class="fas fa-camera"></i> Explore Attractions
                        </button>
                    </div>
                    
                    <h3>My Products (${myProducts.length})</h3>
                    ${myProducts.length > 0 ? 
                        `<div class="products-grid" style="margin-top: 20px;">
                            ${await Promise.all(myProducts.map(async p => {
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(p.id, 'product', 1, 0);
                                const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(p.id, 'product');
                                const categoryIcons = {
                                    'fish': 'üêü',
                                    'goat': 'üêê',
                                    'cow': 'üêÑ',
                                    'poultry': 'üêì',
                                    'agriculture': 'üåæ',
                                    'tourism': 'üèûÔ∏è',
                                    'services': 'üîß',
                                    'property': 'üè†',
                                    'vehicles': 'üöó'
                                };
                                const icon = categoryIcons[p.category] || 'üì¶';
                                
                                let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                                let mediaBadge = '';
                                
                                if (media.length > 0) {
                                    const firstMedia = media[0];
                                    if (firstMedia.mediaType === 'image') {
                                        mediaElement = `<img src="${firstMedia.dataUrl}" alt="${p.title}" onclick="openMediaGallery(${p.id}, 'product')">`;
                                    } else if (firstMedia.mediaType === 'video') {
                                        mediaElement = `
                                            <video onclick="openMediaGallery(${p.id}, 'product')">
                                                <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                                            </video>
                                            <div class="file-type-badge">VIDEO</div>
                                        `;
                                    }
                                    
                                    if (mediaCount > 1) {
                                        mediaBadge = `<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">
                                            <i class="fas fa-camera"></i> ${mediaCount}
                                        </div>`;
                                    }
                                }
                                
                                return `
                                    <div class="product-card">
                                        <div class="product-image">
                                            ${mediaElement}
                                            ${mediaBadge}
                                            <div class="product-price">$${p.price}</div>
                                        </div>
                                        <div class="product-details">
                                            <h3 class="product-title">${p.title}</h3>
                                            <p class="product-meta">Status: <span class="status-badge ${!p.approved ? 'status-pending' : p.status === 'active' ? 'status-active' : 'status-rejected'}">
                                                ${!p.approved ? 'Pending Approval' : p.status === 'active' ? 'Active' : 'Rejected'}
                                            </span></p>
                                            <p class="product-meta">Views: ${p.views || 0}</p>
                                            <div class="product-location">
                                                <i class="fas fa-map-marker-alt"></i> ${p.location}
                                            </div>
                                            <div class="action-buttons">
                                                ${!p.approved ? 
                                                    `<button class="action-btn" style="background: #f0f0f0;" onclick="showToast('Ad pending admin approval. Contact +263 77 286 3815', 'info')">
                                                        <i class="fas fa-clock"></i> Awaiting Approval
                                                    </button>` : ''
                                                }
                                                <button class="action-btn delete" onclick="deleteAd(${p.id})">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>` :
                        `<div class="no-products" style="padding: 30px; margin-top: 20px;">
                            <div style="font-size: 60px; margin-bottom: 20px;">üì¶</div>
                            <h3>You haven't posted any ads yet</h3>
                            <p>Start selling by posting your first ad</p>
                            <button class="btn btn-primary" onclick="showPostAdForm()" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Post Your First Ad
                            </button>
                        </div>`
                    }
                    
                    <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Important Information</h4>
                        <ul style="margin-top: 10px; color: #666;">
                            <li style="margin-bottom: 8px;">‚úì All ads require administrator approval</li>
                            <li style="margin-bottom: 8px;">‚úì Contact +263 77 286 3815 for faster approval</li>
                            <li style="margin-bottom: 8px;">‚úì Approved ads appear on homepage immediately</li>
                            <li style="margin-bottom: 8px;">‚úì Upload photos and videos to increase sales</li>
                            <li>‚úì Products with media sell 5x faster!</li>
                        </ul>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading user dashboard:', error);
                showToast('Error loading dashboard', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Delete ad
        async function deleteAd(productId) {
            if (confirm('Are you sure you want to delete this ad? This cannot be undone.')) {
                showLoading();
                try {
                    await BINGA_MARKETPLACE_DB.products.delete(productId);
                    
                    if (currentUser && currentUser.products) {
                        const index = currentUser.products.indexOf(productId);
                        if (index > -1) {
                            currentUser.products.splice(index, 1);
                            localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                        }
                    }
                    
                    showToast('Ad deleted successfully', 'success');
                    loadUserDashboard();
                    loadMarketplace();
                    loadCategories();
                    loadLocations();
                    updateStorageStats();
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    showToast('Error deleting ad. Please try again.', 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        
        // Render pagination
        function renderPagination(containerId, currentPage, totalPages, callback) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'page-btn';
                prevBtn.innerHTML = '‚Äπ';
                prevBtn.onclick = () => callback(currentPage - 1);
                container.appendChild(prevBtn);
            }
            
            // Page numbers
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            if (endPage - startPage + 1 < maxPages) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => callback(i);
                container.appendChild(pageBtn);
            }
            
            // Next button
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'page-btn';
                nextBtn.innerHTML = '‚Ä∫';
                nextBtn.onclick = () => callback(currentPage + 1);
                container.appendChild(nextBtn);
            }
        }
        
        // Close modal when clicking outside
                // Complete the missing parts from the cut-off code

        // Close modal when clicking outside
        document.getElementById('authModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuthModal();
            }
        });

        // Close media modal when clicking outside
        document.getElementById('mediaModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMediaModal();
            }
        });

        // Handle forgot password
        function handleForgotPassword() {
            showToast('For security, please contact administrator at +263 77 286 3815 to reset your password', 'info');
        }

        // Load tourism content
        async function loadTourismContent() {
            showLoading();
            try {
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getActive();
                const container = document.getElementById('tourismContent');
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 300px; gap: 30px; margin-top: 20px;">
                        <div>
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <h3 style="margin-bottom: 15px; color: var(--tourist);">
                                    <i class="fas fa-info-circle"></i> Explore Binga Tourism
                                </h3>
                                <p style="color: #666; margin-bottom: 15px;">
                                    Binga is home to some of Zimbabwe's most beautiful tourist attractions. 
                                    From the shores of Lake Kariba to natural hot springs, there's something for every visitor.
                                </p>
                                <p style="color: #666;">
                                    Contact the tourism administrator at +263 77 286 3815 for bookings and inquiries.
                                </p>
                            </div>
                            
                            <h3 style="margin: 30px 0 20px 0;">Tourist Attractions</h3>
                            
                            ${attractions.length > 0 ? 
                                `<div class="products-grid">
                                    ${await Promise.all(attractions.map(attraction => renderAttractionCard(attraction))).join('')}
                                </div>` :
                                `<div class="no-products">
                                    <div style="font-size: 60px; margin-bottom: 20px;">üèûÔ∏è</div>
                                    <h3>No Tourist Attractions Listed Yet</h3>
                                    <p>Administrators can add attractions to showcase Binga's beauty</p>
                                </div>`
                            }
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: fit-content;">
                            <h4 style="margin-bottom: 15px; color: var(--dark);">Tourism Information</h4>
                            <ul style="list-style: none; color: #666;">
                                <li style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-phone" style="color: var(--tourist);"></i>
                                    <div>
                                        <strong>Tourism Contact:</strong><br>
                                        +263 77 286 3815
                                    </div>
                                </li>
                                <li style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-map-marker-alt" style="color: var(--tourist);"></i>
                                    <div>
                                        <strong>Location:</strong><br>
                                        Binga, Lake Kariba Shore
                                    </div>
                                </li>
                                <li style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-clock" style="color: var(--tourist);"></i>
                                    <div>
                                        <strong>Best Time to Visit:</strong><br>
                                        April - October (Dry Season)
                                    </div>
                                </li>
                                <li style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-utensils" style="color: var(--tourist);"></i>
                                    <div>
                                        <strong>Activities:</strong><br>
                                        Fishing, Boat Rides, Photography
                                    </div>
                                </li>
                            </ul>
                            
                            ${currentUser && currentUser.type === 'admin' ? `
                                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
                                    <h4 style="margin-bottom: 15px; color: var(--admin);">Admin Controls</h4>
                                    <button class="btn btn-primary" onclick="showAddAttractionForm()" style="width: 100%; background: var(--admin);">
                                        <i class="fas fa-plus"></i> Add New Attraction
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading tourism content:', error);
                showToast('Error loading tourism information', 'error');
            } finally {
                hideLoading();
            }
        }

        // Show add attraction form
        async function showAddAttractionForm() {
            if (!currentUser || currentUser.type !== 'admin') {
                openAuthModal('login', 'admin');
                return;
            }
            
            uploadedMedia = [];
            
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('tourismSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('postAdSection').style.display = 'none';
            document.getElementById('editAttractionSection').style.display = 'none';
            
            document.getElementById('addAttractionSection').style.display = 'block';
            
            const types = await BINGA_MARKETPLACE_DB.attractionTypes.getAll();
            const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
            
            document.getElementById('addAttractionForm').innerHTML = `
                <form id="attractionForm">
                    <div class="form-group">
                        <label class="form-label">Attraction Name*</label>
                        <input type="text" class="form-control" id="attractionName" placeholder="e.g., Lake Kariba Shore" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="attractionDescription" rows="4" placeholder="Describe this attraction in detail..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type*</label>
                        <select class="form-control" id="attractionType" required>
                            <option value="">Select Type</option>
                            ${types.map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location*</label>
                        <select class="form-control" id="attractionLocation" required>
                            <option value="">Select Location</option>
                            ${locations.map(l => `<option value="${l.id}">${l.name}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">WhatsApp Contact*</label>
                        <input type="tel" class="form-control" id="attractionPhone" value="263772863815" required>
                        <small style="color: #666;">Tourists will contact this number for bookings</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Upload Photos & Videos</label>
                        <div style="margin-top: 15px;">
                            <label for="attractionMediaUpload" class="image-upload-btn">
                                <i class="fas fa-upload"></i> Upload Media
                            </label>
                            <input type="file" id="attractionMediaUpload" accept="image/*,video/*" multiple onchange="handleAttractionMediaUpload(event)" style="display: none;">
                        </div>
                        
                        <div class="image-upload-container" id="attractionMediaPreviewContainer">
                            <!-- Media previews will appear here -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="attractionFeatured" style="width: auto;">
                            <label class="form-label" style="margin-bottom: 0;">Feature this attraction on homepage</label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-primary" onclick="submitAttraction()">
                            <i class="fas fa-plus-circle"></i> Add Attraction
                        </button>
                        
                        <button type="button" class="btn" onclick="showSection('tourism')" style="background: #f0f0f0;">
                            Cancel
                        </button>
                    </div>
                </form>
            `;
        }

        // Handle attraction media upload
        function handleAttractionMediaUpload(event) {
            handleMediaUpload(event);
        }

        // Submit attraction
        async function submitAttraction() {
            const name = document.getElementById('attractionName').value.trim();
            const description = document.getElementById('attractionDescription').value.trim();
            const type = document.getElementById('attractionType').value;
            const location = document.getElementById('attractionLocation').value;
            const phone = document.getElementById('attractionPhone').value.replace(/\D/g, '');
            const featured = document.getElementById('attractionFeatured').checked;
            
            if (!name || !description || !type || !location || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (phone.length < 9 || !phone.startsWith('263')) {
                showToast('Please enter a valid Zimbabwean phone number starting with 263', 'error');
                return;
            }
            
            const whatsappLink = `https://wa.me/${phone}?text=Hi! I want to visit ${encodeURIComponent(name)}`;
            
            const attraction = {
                id: Date.now(),
                name: name,
                description: description,
                type: type,
                typeName: (await BINGA_MARKETPLACE_DB.attractionTypes.getAll()).find(t => t.id === type)?.name || type,
                location: location,
                whatsappLink: whatsappLink,
                status: 'active',
                addedBy: currentUser.id,
                featured: featured,
                createdAt: new Date().toISOString()
            };
            
            showLoading();
            try {
                // Save attraction
                await BINGA_MARKETPLACE_DB.attractions.add(attraction);
                
                // Save media
                if (uploadedMedia.length > 0) {
                    for (const media of uploadedMedia) {
                        media.entityId = attraction.id;
                        media.entityType = 'attraction';
                        await BINGA_MARKETPLACE_DB.media.add(media);
                    }
                }
                
                showToast('Tourist attraction added successfully!', 'success');
                
                // Add admin log
                addAdminLog('add_attraction', { attractionId: attraction.id, name: attraction.name });
                
                // Clear form
                uploadedMedia = [];
                
                // Go back to tourism section
                showSection('tourism');
                updateStorageStats();
            } catch (error) {
                console.error('Error adding attraction:', error);
                showToast('Error adding attraction. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }

        // Show admin tab
        async function showAdminTab(tab) {
            const tabs = document.querySelectorAll('.admin-tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            document.querySelector(`.admin-tab[onclick*="${tab}"]`).classList.add('active');
            
            const content = document.getElementById('adminContent');
            
            showLoading();
            try {
                switch(tab) {
                    case 'pending':
                        await loadPendingApprovals();
                        break;
                    case 'products':
                        await loadAllProducts();
                        break;
                    case 'attractions':
                        await loadAllAttractions();
                        break;
                    case 'users':
                        await loadAllUsers();
                        break;
                    case 'reported':
                        await loadReportedItems();
                        break;
                    case 'stats':
                        await loadAdminStats();
                        break;
                    case 'settings':
                        await loadAdminSettings();
                        break;
                    case 'danger':
                        await loadDangerZone();
                        break;
                }
            } catch (error) {
                console.error(`Error loading admin tab ${tab}:`, error);
                showToast(`Error loading ${tab} tab`, 'error');
            } finally {
                hideLoading();
            }
        }

        // Load pending approvals
        async function loadPendingApprovals() {
            const pendingProducts = await BINGA_MARKETPLACE_DB.products.getPending();
            const pendingUsers = (await BINGA_MARKETPLACE_DB.users.getAll()).filter(u => u.type === 'seller' && !u.approved);
            
            let html = `
                <h3>Pending Approvals</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    Review and approve pending products and seller accounts.
                </p>
            `;
            
            if (pendingProducts.length === 0 && pendingUsers.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">‚úÖ</div>
                        <h3>No Pending Approvals</h3>
                        <p>All items are approved!</p>
                    </div>
                `;
            } else {
                if (pendingProducts.length > 0) {
                    html += `
                        <h4 style="margin: 30px 0 15px 0;">Products Pending Approval (${pendingProducts.length})</h4>
                        <div style="display: grid; gap: 20px;">
                            ${await Promise.all(pendingProducts.map(async (product, index) => {
                                const seller = await BINGA_MARKETPLACE_DB.users.get(product.sellerId);
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(product.id, 'product', 1, 0);
                                
                                return `
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--warning);">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 15px;">
                                            <div style="flex: 1;">
                                                <h4 style="margin-bottom: 5px;">${product.title}</h4>
                                                <p style="color: #666; margin-bottom: 10px;">
                                                    <strong>Price:</strong> $${product.price} | 
                                                    <strong>Location:</strong> ${product.location} | 
                                                    <strong>Category:</strong> ${product.category}
                                                </p>
                                                <p style="color: #666; margin-bottom: 10px;">${product.description.substring(0, 150)}...</p>
                                                <p style="color: #666; margin-bottom: 10px;">
                                                    <strong>Seller:</strong> ${seller?.name || 'Unknown'} (${seller?.phone || 'No phone'})
                                                </p>
                                                <p style="color: #666; margin-bottom: 10px;">
                                                    <strong>Submitted:</strong> ${new Date(product.createdAt).toLocaleDateString()}
                                                </p>
                                                ${product.adminNote ? `
                                                    <p style="color: var(--warning); margin-bottom: 10px;">
                                                        <strong>Seller Note:</strong> ${product.adminNote}
                                                    </p>
                                                ` : ''}
                                            </div>
                                            
                                            ${media.length > 0 ? `
                                                <div style="width: 120px; height: 120px; border-radius: 6px; overflow: hidden; cursor: pointer;" onclick="openMediaGallery(${product.id}, 'product')">
                                                    <img src="${media[0].dataUrl}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <div class="action-buttons">
                                            <button class="action-btn approve" onclick="approveProduct(${product.id})">
                                                <i class="fas fa-check"></i> Approve
                                            </button>
                                            <button class="action-btn reject" onclick="rejectProduct(${product.id})">
                                                <i class="fas fa-times"></i> Reject
                                            </button>
                                            <button class="action-btn edit" onclick="editProduct(${product.id})">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button class="action-btn view" onclick="viewProductMedia(${product.id})">
                                                <i class="fas fa-images"></i> View Media (${await BINGA_MARKETPLACE_DB.media.countByEntity(product.id, 'product')})
                                            </button>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>
                    `;
                }
                
                if (pendingUsers.length > 0) {
                    html += `
                        <h4 style="margin: 40px 0 15px 0;">Seller Accounts Pending Approval (${pendingUsers.length})</h4>
                        <div style="display: grid; gap: 15px;">
                            ${pendingUsers.map(user => `
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                        <div>
                                            <h5 style="margin-bottom: 5px;">${user.name}</h5>
                                            <p style="color: #666; margin-bottom: 5px;">
                                                <strong>Username:</strong> ${user.username} | 
                                                <strong>Phone:</strong> ${user.phone}
                                            </p>
                                            <p style="color: #666;">
                                                <strong>Location:</strong> ${user.location} | 
                                                <strong>Registered:</strong> ${new Date(user.registered).toLocaleDateString()}
                                            </p>
                                        </div>
                                        
                                        <div class="action-buttons">
                                            <button class="action-btn approve" onclick="approveUser(${user.id})">
                                                <i class="fas fa-check"></i> Approve
                                            </button>
                                            <button class="action-btn reject" onclick="rejectUser(${user.id})">
                                                <i class="fas fa-times"></i> Reject
                                            </button>
                                            <button class="action-btn delete" onclick="deleteUser(${user.id})">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Approve product
        async function approveProduct(productId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.update(productId, {
                    approved: true,
                    status: 'active'
                });
                
                // Add admin log
                addAdminLog('approve_product', { productId: productId });
                
                showToast('Product approved successfully!', 'success');
                loadAdminDashboard();
                showAdminTab('pending');
            } catch (error) {
                console.error('Error approving product:', error);
                showToast('Error approving product', 'error');
            } finally {
                hideLoading();
            }
        }

        // Reject product
        async function rejectProduct(productId) {
            const reason = prompt('Enter rejection reason for the seller:');
            if (reason === null) return;
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.update(productId, {
                    approved: false,
                    status: 'rejected',
                    rejectionReason: reason
                });
                
                // Add admin log
                addAdminLog('reject_product', { productId: productId, reason: reason });
                
                showToast('Product rejected successfully', 'success');
                loadAdminDashboard();
                showAdminTab('pending');
            } catch (error) {
                console.error('Error rejecting product:', error);
                showToast('Error rejecting product', 'error');
            } finally {
                hideLoading();
            }
        }

        // View product media
        async function viewProductMedia(productId) {
            openMediaGallery(productId, 'product');
        }

        // Edit product (admin)
        async function editProduct(productId) {
            showToast('Edit feature coming soon!', 'info');
        }

        // Approve user
        async function approveUser(userId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.users.update(userId, {
                    approved: true,
                    status: 'active'
                });
                
                // Add admin log
                addAdminLog('approve_user', { userId: userId });
                
                showToast('User approved successfully!', 'success');
                loadAdminDashboard();
                showAdminTab('pending');
            } catch (error) {
                console.error('Error approving user:', error);
                showToast('Error approving user', 'error');
            } finally {
                hideLoading();
            }
        }

        // Reject user
        async function rejectUser(userId) {
            const reason = prompt('Enter rejection reason:');
            if (reason === null) return;
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.users.update(userId, {
                    approved: false,
                    status: 'rejected',
                    rejectionReason: reason
                });
                
                // Add admin log
                addAdminLog('reject_user', { userId: userId, reason: reason });
                
                showToast('User rejected successfully', 'success');
                loadAdminDashboard();
                showAdminTab('pending');
            } catch (error) {
                console.error('Error rejecting user:', error);
                showToast('Error rejecting user', 'error');
            } finally {
                hideLoading();
            }
        }

        // Delete user
        async function deleteUser(userId) {
            if (!confirm('WARNING: This will permanently delete the user and all their products. Continue?')) {
                return;
            }
            
            showLoading();
            try {
                // Get user's products
                const userProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(userId);
                
                // Delete all user's products and media
                for (const product of userProducts) {
                    await BINGA_MARKETPLACE_DB.products.delete(product.id);
                }
                
                // Delete user
                await BINGA_MARKETPLACE_DB.users.delete(userId);
                
                // Add admin log
                addAdminLog('delete_user', { userId: userId });
                
                showToast('User deleted successfully', 'success');
                loadAdminDashboard();
                showAdminTab('pending');
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast('Error deleting user', 'error');
            } finally {
                hideLoading();
            }
        }

        // Load all products for admin
        async function loadAllProducts() {
            const products = await BINGA_MARKETPLACE_DB.products.getAll();
            const categories = await BINGA_MARKETPLACE_DB.categories.getAll();
            const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
            
            // Filter controls
            let html = `
                <h3>All Products (${products.length})</h3>
                
                <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                    <select class="form-control" id="adminCategoryFilter" style="max-width: 200px;" onchange="filterAdminProducts()">
                        <option value="">All Categories</option>
                        ${categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                    </select>
                    
                    <select class="form-control" id="adminStatusFilter" style="max-width: 200px;" onchange="filterAdminProducts()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="active">Active</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    
                    <select class="form-control" id="adminLocationFilter" style="max-width: 200px;" onchange="filterAdminProducts()">
                        <option value="">All Locations</option>
                        ${locations.map(l => `<option value="${l.id}">${l.name}</option>`).join('')}
                    </select>
                    
                    <input type="text" class="search-input" id="adminProductSearch" placeholder="Search products..." style="max-width: 250px;" onkeyup="filterAdminProducts()">
                    
                    <button class="btn" onclick="exportProducts()" style="background: var(--accent); color: white;">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            `;
            
            if (products.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì¶</div>
                        <h3>No Products Found</h3>
                        <p>Start by approving pending products</p>
                    </div>
                `;
            } else {
                html += `
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Location</th>
                                    <th>Seller</th>
                                    <th>Status</th>
                                    <th>Views</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${products.map(p => `
                                    <tr>
                                        <td>${p.id}</td>
                                        <td>${p.title.substring(0, 30)}${p.title.length > 30 ? '...' : ''}</td>
                                        <td>${p.category}</td>
                                        <td>$${p.price}</td>
                                        <td>${p.location}</td>
                                        <td>${p.sellerName || 'Unknown'}</td>
                                        <td>
                                            <span class="status-badge ${!p.approved ? 'status-pending' : p.status === 'active' ? 'status-active' : 'status-rejected'}">
                                                ${!p.approved ? 'Pending' : p.status === 'active' ? 'Active' : 'Rejected'}
                                            </span>
                                        </td>
                                        <td>${p.views || 0}</td>
                                        <td>${new Date(p.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <div style="display: flex; gap: 5px;">
                                                <button class="action-btn edit" onclick="adminEditProduct(${p.id})" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="action-btn view" onclick="openMediaGallery(${p.id}, 'product')" title="View Media">
                                                    <i class="fas fa-images"></i>
                                                </button>
                                                ${!p.featured ? 
                                                    `<button class="action-btn feature" onclick="featureProduct(${p.id})" title="Feature">
                                                        <i class="fas fa-star"></i>
                                                    </button>` :
                                                    `<button class="action-btn unfeature" onclick="unfeatureProduct(${p.id})" title="Unfeature">
                                                        <i class="fas fa-star"></i>
                                                    </button>`
                                                }
                                                <button class="action-btn delete" onclick="adminDeleteProduct(${p.id})" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; color: #666;">
                        <div>Showing ${products.length} products</div>
                        <div>
                            <button class="btn" onclick="deleteAllProducts()" style="background: var(--danger); color: white;">
                                <i class="fas fa-trash-alt"></i> Delete All Products
                            </button>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Filter admin products
        async function filterAdminProducts() {
            // Implementation for filtering products in admin view
            showToast('Filtering feature coming soon!', 'info');
        }

        // Export products
        function exportProducts() {
            showToast('Export feature coming soon!', 'info');
        }

        // Feature product
        async function featureProduct(productId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.update(productId, { featured: true });
                
                // Add admin log
                addAdminLog('feature_product', { productId: productId });
                
                showToast('Product featured successfully!', 'success');
                showAdminTab('products');
            } catch (error) {
                console.error('Error featuring product:', error);
                showToast('Error featuring product', 'error');
            } finally {
                hideLoading();
            }
        }

        // Unfeature product
        async function unfeatureProduct(productId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.update(productId, { featured: false });
                
                // Add admin log
                addAdminLog('unfeature_product', { productId: productId });
                
                showToast('Product unfeatured successfully!', 'success');
                showAdminTab('products');
            } catch (error) {
                console.error('Error unfeaturing product:', error);
                showToast('Error unfeaturing product', 'error');
            } finally {
                hideLoading();
            }
        }

        // Admin edit product
        async function adminEditProduct(productId) {
            showToast('Product editing feature coming soon!', 'info');
        }

        // Admin delete product
        async function adminDeleteProduct(productId) {
            if (!confirm('Delete this product permanently?')) return;
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.delete(productId);
                
                // Add admin log
                addAdminLog('delete_product', { productId: productId });
                
                showToast('Product deleted successfully', 'success');
                showAdminTab('products');
                loadAdminDashboard();
            } catch (error) {
                console.error('Error deleting product:', error);
                showToast('Error deleting product', 'error');
            } finally {
                hideLoading();
            }
        }

        // Delete all products
        async function deleteAllProducts() {
            if (!confirm('WARNING: This will delete ALL products permanently! This cannot be undone. Continue?')) {
                return;
            }
            
            if (!confirm('Are you absolutely sure? This will delete EVERY product in the system.')) {
                return;
            }
            
            const password = prompt('Enter admin password to confirm:');
            if (password !== 'PickGod') {
                showToast('Incorrect password! Operation cancelled.', 'error');
                return;
            }
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.products.deleteAll();
                
                // Add admin log
                addAdminLog('delete_all_products', {});
                
                showToast('All products deleted successfully', 'success');
                showAdminTab('products');
                loadAdminDashboard();
                loadMarketplace();
            } catch (error) {
                console.error('Error deleting all products:', error);
                showToast('Error deleting all products', 'error');
            } finally {
                hideLoading();
            }
        }

        // Load all attractions for admin
        async function loadAllAttractions() {
            const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
            const types = await BINGA_MARKETPLACE_DB.attractionTypes.getAll();
            
            let html = `
                <h3>Tourist Attractions (${attractions.length})</h3>
                
                <div style="margin: 20px 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <button class="btn btn-primary" onclick="showAddAttractionForm()" style="background: var(--tourist);">
                            <i class="fas fa-plus"></i> Add New Attraction
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <select class="form-control" id="adminAttractionFilter" style="max-width: 200px;" onchange="filterAdminAttractions()">
                            <option value="">All Types</option>
                            ${types.map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
            `;
            
            if (attractions.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üèûÔ∏è</div>
                        <h3>No Tourist Attractions</h3>
                        <p>Add attractions to showcase Binga's beauty</p>
                    </div>
                `;
            } else {
                html += `
                    <div style="display: grid; gap: 20px;">
                        ${attractions.map(async a => {
                            const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(a.id, 'attraction');
                            const addedBy = await BINGA_MARKETPLACE_DB.users.get(a.addedBy);
                            
                            return `
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--tourist);">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 15px;">
                                        <div style="flex: 1;">
                                            <h4 style="margin-bottom: 5px;">
                                                ${a.name}
                                                ${a.featured ? '<span class="status-badge status-pending" style="margin-left: 10px;">‚≠ê Featured</span>' : ''}
                                            </h4>
                                            <p style="color: #666; margin-bottom: 10px;">
                                                <strong>Type:</strong> ${a.typeName || a.type} | 
                                                <strong>Location:</strong> ${a.location}
                                            </p>
                                            <p style="color: #666; margin-bottom: 10px;">${a.description.substring(0, 150)}...</p>
                                            <p style="color: #666; margin-bottom: 10px;">
                                                <strong>Added by:</strong> ${addedBy?.name || 'Unknown'} | 
                                                <strong>Date:</strong> ${new Date(a.createdAt).toLocaleDateString()}
                                            </p>
                                            <p style="color: #666;">
                                                <strong>Media:</strong> ${mediaCount} files | 
                                                <strong>WhatsApp:</strong> ${a.whatsappLink?.split('wa.me/')[1]?.split('?')[0] || 'Not set'}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="action-buttons">
                                        <button class="action-btn edit" onclick="adminEditAttraction(${a.id})">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="action-btn view" onclick="openMediaGallery(${a.id}, 'attraction')">
                                            <i class="fas fa-images"></i> View Media (${mediaCount})
                                        </button>
                                        ${a.featured ? 
                                            `<button class="action-btn unfeature" onclick="adminUnfeatureAttraction(${a.id})">
                                                <i class="fas fa-star"></i> Unfeature
                                            </button>` :
                                            `<button class="action-btn feature" onclick="adminFeatureAttraction(${a.id})">
                                                <i class="fas fa-star"></i> Feature
                                            </button>`
                                        }
                                        <button class="action-btn delete" onclick="adminDeleteAttraction(${a.id})">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Filter admin attractions
        function filterAdminAttractions() {
            showToast('Filtering attractions coming soon!', 'info');
        }

        // Admin edit attraction
        async function adminEditAttraction(attractionId) {
            showLoading();
            try {
                const attraction = await BINGA_MARKETPLACE_DB.attractions.get(attractionId);
                if (!attraction) {
                    showToast('Attraction not found', 'error');
                    return;
                }
                
                uploadedMedia = [];
                
                const types = await BINGA_MARKETPLACE_DB.attractionTypes.getAll();
                const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
                
                document.getElementById('homeSection').style.display = 'none';
                document.getElementById('tourismSection').style.display = 'none';
                document.getElementById('dashboardSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('postAdSection').style.display = 'none';
                document.getElementById('addAttractionSection').style.display = 'none';
                
                document.getElementById('editAttractionSection').style.display = 'block';
                
                document.getElementById('editAttractionForm').innerHTML = `
                    <form id="editAttractionFormInner">
                        <div class="form-group">
                            <label class="form-label">Attraction Name*</label>
                            <input type="text" class="form-control" id="editAttractionName" value="${attraction.name}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description*</label>
                            <textarea class="form-control" id="editAttractionDescription" rows="4" required>${attraction.description}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Type*</label>
                            <select class="form-control" id="editAttractionType" required>
                                <option value="">Select Type</option>
                                ${types.map(t => `<option value="${t.id}" ${t.id === attraction.type ? 'selected' : ''}>${t.name}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location*</label>
                            <select class="form-control" id="editAttractionLocation" required>
                                <option value="">Select Location</option>
                                ${locations.map(l => `<option value="${l.id}" ${l.id === attraction.location ? 'selected' : ''}>${l.name}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">WhatsApp Contact*</label>
                            <input type="tel" class="form-control" id="editAttractionPhone" value="${attraction.whatsappLink?.split('wa.me/')[1]?.split('?')[0] || '263772863815'}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Current Media</label>
                            <div class="image-upload-container" id="currentMediaContainer">
                                <!-- Current media will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Add More Media</label>
                            <div style="margin-top: 15px;">
                                <label for="editMediaUpload" class="image-upload-btn">
                                    <i class="fas fa-upload"></i> Add More Media
                                </label>
                                <input type="file" id="editMediaUpload" accept="image/*,video/*" multiple onchange="handleEditMediaUpload(event)" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="editAttractionFeatured" ${attraction.featured ? 'checked' : ''} style="width: auto;">
                                <label class="form-label" style="margin-bottom: 0;">Feature this attraction on homepage</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="editAttractionActive" ${attraction.status === 'active' ? 'checked' : ''} style="width: auto;">
                                <label class="form-label" style="margin-bottom: 0;">Active (visible to visitors)</label>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="updateAttraction(${attractionId})">
                                <i class="fas fa-save"></i> Update Attraction
                            </button>
                            
                            <button type="button" class="btn" onclick="showAdminTab('attractions')" style="background: #f0f0f0;">
                                Cancel
                            </button>
                        </div>
                    </form>
                `;
                
                // Load current media
                await loadCurrentAttractionMedia(attractionId);
                
            } catch (error) {
                console.error('Error loading edit attraction form:', error);
                showToast('Error loading edit form', 'error');
            } finally {
                hideLoading();
            }
        }

        // Load current attraction media for editing
        async function loadCurrentAttractionMedia(attractionId) {
            const container = document.getElementById('currentMediaContainer');
            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(attractionId, 'attraction');
            
            container.innerHTML = '';
            
            media.forEach((item, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                
                if (item.mediaType === 'image') {
                    previewDiv.innerHTML = `<img src="${item.dataUrl}" alt="Current media ${index + 1}">`;
                } else {
                    previewDiv.innerHTML = `
                        <video>
                            <source src="${item.dataUrl}" type="${item.mimeType}">
                        </video>
                        <div style="position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px;">
                            <i class="fas fa-play"></i> Video
                        </div>
                    `;
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-image';
                removeBtn.innerHTML = '√ó';
                removeBtn.onclick = () => {
                    if (confirm('Delete this media permanently?')) {
                        deleteMediaItem(item.id, attractionId);
                    }
                };
                
                previewDiv.appendChild(removeBtn);
                container.appendChild(previewDiv);
            });
        }

        // Handle edit media upload
        function handleEditMediaUpload(event) {
            handleMediaUpload(event);
        }

        // Update attraction
        async function updateAttraction(attractionId) {
            const name = document.getElementById('editAttractionName').value.trim();
            const description = document.getElementById('editAttractionDescription').value.trim();
            const type = document.getElementById('editAttractionType').value;
            const location = document.getElementById('editAttractionLocation').value;
            const phone = document.getElementById('editAttractionPhone').value.replace(/\D/g, '');
            const featured = document.getElementById('editAttractionFeatured').checked;
            const active = document.getElementById('editAttractionActive').checked;
            
            if (!name || !description || !type || !location || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            const whatsappLink = `https://wa.me/${phone}?text=Hi! I want to visit ${encodeURIComponent(name)}`;
            
            showLoading();
            try {
                const updates = {
                    name: name,
                    description: description,
                    type: type,
                    typeName: (await BINGA_MARKETPLACE_DB.attractionTypes.getAll()).find(t => t.id === type)?.name || type,
                    location: location,
                    whatsappLink: whatsappLink,
                    featured: featured,
                    status: active ? 'active' : 'inactive'
                };
                
                await BINGA_MARKETPLACE_DB.attractions.update(attractionId, updates);
                
                // Save any new media
                if (uploadedMedia.length > 0) {
                    for (const media of uploadedMedia) {
                        media.entityId = attractionId;
                        media.entityType = 'attraction';
                        await BINGA_MARKETPLACE_DB.media.add(media);
                    }
                    uploadedMedia = [];
                }
                
                // Add admin log
                addAdminLog('update_attraction', { attractionId: attractionId, name: name });
                
                showToast('Attraction updated successfully!', 'success');
                showAdminTab('attractions');
            } catch (error) {
                console.error('Error updating attraction:', error);
                showToast('Error updating attraction', 'error');
            } finally {
                hideLoading();
            }
        }

        // Delete media item
        async function deleteMediaItem(mediaId, attractionId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.media.delete(mediaId);
                await loadCurrentAttractionMedia(attractionId);
                updateStorageStats();
                showToast('Media deleted successfully', 'success');
            } catch (error) {
                console.error('Error deleting media:', error);
                showToast('Error deleting media', 'error');
            } finally {
                hideLoading();
            }
        }

        // Admin feature attraction
        async function adminFeatureAttraction(attractionId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.attractions.update(attractionId, { featured: true });
                
                // Add admin log
                addAdminLog('feature_attraction', { attractionId: attractionId });
                
                showToast('Attraction featured successfully!', 'success');
                showAdminTab('attractions');
            } catch (error) {
                console.error('Error featuring attraction:', error);
                showToast('Error featuring attraction', 'error');
            } finally {
                hideLoading();
            }
        }

        // Admin unfeature attraction
        async function adminUnfeatureAttraction(attractionId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.attractions.update(attractionId, { featured: false });
                
                // Add admin log
                addAdminLog('unfeature_attraction', { attractionId: attractionId });
                
                showToast('Attraction unfeatured successfully!', 'success');
                showAdminTab('attractions');
            } catch (error) {
                console.error('Error unfeaturing attraction:', error);
                showToast('Error unfeaturing attraction', 'error');
            } finally {
                hideLoading();
            }
        }

        // Admin delete attraction
        async function adminDeleteAttraction(attractionId) {
            if (!confirm('Delete this attraction permanently?')) return;
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.attractions.delete(attractionId);
                
                // Add admin log
                addAdminLog('delete_attraction', { attractionId: attractionId });
                
                showToast('Attraction deleted successfully', 'success');
                showAdminTab('attractions');
                loadAdminDashboard();
            } catch (error) {
                console.error('Error deleting attraction:', error);
                showToast('Error deleting attraction', 'error');
            } finally {
                hideLoading();
            }
        }

        // Load all users for admin
        async function loadAllUsers() {
            const users = await BINGA_MARKETPLACE_DB.users.getAll();
            const sellers = users.filter(u => u.type === 'seller');
            
            let html = `
                <h3>User Management (${sellers.length} sellers)</h3>
                
                <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                    <input type="text" class="search-input" id="userSearch" placeholder="Search users..." style="max-width: 300px;" onkeyup="filterUsers()">
                    <button class="btn" onclick="exportUsers()" style="background: var(--accent); color: white;">
                        <i class="fas fa-download"></i> Export Users
                    </button>
                </div>
            `;
            
            if (sellers.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üë§</div>
                        <h3>No Seller Accounts</h3>
                        <p>Users will appear here when they register</p>
                    </div>
                `;
            } else {
                html += `
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Phone</th>
                                    <th>Location</th>
                                    <th>Products</th>
                                    <th>Status</th>
                                    <th>Registered</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sellers.map(async user => {
                                    const userProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(user.id);
                                    const activeProducts = userProducts.filter(p => p.status === 'active' && p.approved).length;
                                    
                                    return `
                                        <tr>
                                            <td>${user.id}</td>
                                            <td>${user.name}</td>
                                            <td>${user.username}</td>
                                            <td>${user.phone}</td>
                                            <td>${user.location}</td>
                                            <td>${activeProducts}/${userProducts.length} active</td>
                                            <td>
                                                <span class="status-badge ${!user.approved ? 'status-pending' : user.status === 'active' ? 'status-active' : 'status-rejected'}">
                                                    ${!user.approved ? 'Pending' : user.status === 'active' ? 'Active' : 'Rejected'}
                                                </span>
                                            </td>
                                            <td>${new Date(user.registered).toLocaleDateString()}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="action-btn edit" onclick="adminEditUser(${user.id})" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="action-btn view" onclick="adminViewUserProducts(${user.id})" title="View Products">
                                                        <i class="fas fa-box"></i>
                                                    </button>
                                                    ${user.status === 'active' ? 
                                                        `<button class="action-btn ban" onclick="banUser(${user.id})" title="Ban User">
                                                            <i class="fas fa-ban"></i>
                                                        </button>` :
                                                        `<button class="action-btn approve" onclick="approveUser(${user.id})" title="Approve">
                                                            <i class="fas fa-check"></i>
                                                        </button>`
                                                    }
                                                    <button class="action-btn delete" onclick="deleteUser(${user.id})" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Filter users
        function filterUsers() {
            showToast('User filtering coming soon!', 'info');
        }

        // Export users
        function exportUsers() {
            showToast('User export feature coming soon!', 'info');
        }

        // Admin edit user
        async function adminEditUser(userId) {
            showToast('User editing feature coming soon!', 'info');
        }

        // Admin view user products
        async function adminViewUserProducts(userId) {
            const user = await BINGA_MARKETPLACE_DB.users.get(userId);
            const products = await BINGA_MARKETPLACE_DB.products.getBySeller(userId);
            
            let html = `
                <h3>Products by ${user?.name || 'Unknown User'}</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    Showing ${products.length} products
                </p>
            `;
            
            if (products.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì¶</div>
                        <h3>No Products Found</h3>
                        <p>This user hasn't posted any products yet</p>
                    </div>
                `;
            } else {
                html += `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        ${products.map(async p => `
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <h4 style="margin-bottom: 10px;">${p.title}</h4>
                                <p style="color: #666; margin-bottom: 10px;">
                                    <strong>Price:</strong> $${p.price} | 
                                    <strong>Category:</strong> ${p.category}
                                </p>
                                <p style="color: #666; margin-bottom: 10px;">
                                    <strong>Status:</strong> 
                                    <span class="status-badge ${!p.approved ? 'status-pending' : p.status === 'active' ? 'status-active' : 'status-rejected'}" style="margin-left: 5px;">
                                        ${!p.approved ? 'Pending' : p.status === 'active' ? 'Active' : 'Rejected'}
                                    </span>
                                </p>
                                <p style="color: #666; margin-bottom: 10px;">
                                    <strong>Views:</strong> ${p.views || 0} | 
                                    <strong>Posted:</strong> ${new Date(p.createdAt).toLocaleDateString()}
                                </p>
                                <div class="action-buttons">
                                    <button class="action-btn edit" onclick="adminEditProduct(${p.id})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete" onclick="adminDeleteProduct(${p.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            html += `
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="showAdminTab('users')" style="background: #f0f0f0;">
                        <i class="fas fa-arrow-left"></i> Back to Users
                    </button>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Ban user
        async function banUser(userId) {
            if (!confirm('Ban this user? They will not be able to login or post new products.')) return;
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.users.update(userId, { status: 'banned' });
                
                // Deactivate all user's products
                const userProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(userId);
                for (const product of userProducts) {
                    await BINGA_MARKETPLACE_DB.products.update(product.id, { status: 'inactive' });
                }
                
                // Add admin log
                addAdminLog('ban_user', { userId: userId });
                
                showToast('User banned successfully', 'success');
                showAdminTab('users');
            } catch (error) {
                console.error('Error banning user:', error);
                showToast('Error banning user', 'error');
            } finally {
                hideLoading();
            }
        }

        // Load reported items
        async function loadReportedItems() {
            const reports = await BINGA_MARKETPLACE_DB.reports.getAll();
            
            let html = `
                <h3>Reported Items (${reports.length})</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    Review reported products and users
                </p>
            `;
            
            if (reports.length === 0) {
                html += `
                    <div class="no-products" style="padding: 30px; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">‚úÖ</div>
                        <h3>No Reported Items</h3>
                        <p>All good! No reports to review.</p>
                    </div>
                `;
            } else {
                html += `
                    <div style="display: grid; gap: 20px;">
                        ${reports.map(r => `
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--danger);">
                                <h4 style="margin-bottom: 10px;">Report #${r.id}</h4>
                                <p style="color: #666; margin-bottom: 10px;">
                                    <strong>Type:</strong> ${r.type} | 
                                    <strong>Reported by:</strong> ${r.reportedBy || 'Anonymous'} | 
                                    <strong>Date:</strong> ${new Date(r.timestamp).toLocaleDateString()}
                                </p>
                                <p style="color: #666; margin-bottom: 15px;">
                                    <strong>Reason:</strong> ${r.reason}
                                </p>
                                <div class="action-buttons">
                                    <button class="action-btn view" onclick="viewReportedItem('${r.entityType}', ${r.entityId})">
                                        <i class="fas fa-eye"></i> View Item
                                    </button>
                                    <button class="action-btn delete" onclick="dismissReport(${r.id})">
                                        <i class="fas fa-times"></i> Dismiss Report
                                    </button>
                                    <button class="action-btn ban" onclick="takeActionOnReport(${r.id}, '${r.entityType}', ${r.entityId})">
                                        <i class="fas fa-gavel"></i> Take Action
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // View reported item
        function viewReportedItem(entityType, entityId) {
            showToast(`Viewing ${entityType} ${entityId} - feature coming soon!`, 'info');
        }

        // Dismiss report
        async function dismissReport(reportId) {
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.reports.delete(reportId);
                
                // Add admin log
                addAdminLog('dismiss_report', { reportId: reportId });
                
                showToast('Report dismissed successfully', 'success');
                showAdminTab('reported');
            } catch (error) {
                console.error('Error dismissing report:', error);
                showToast('Error dismissing report', 'error');
            } finally {
                hideLoading();
            }
        }

        // Take action on report
        function takeActionOnReport(reportId, entityType, entityId) {
            showToast(`Taking action on ${entityType} - feature coming soon!`, 'info');
        }

        // Load admin stats
        async function loadAdminStats() {
            const totalProducts = await BINGA_MARKETPLACE_DB.products.count();
            const activeProducts = await BINGA_MARKETPLACE_DB.products.countActive();
            const pendingProducts = await BINGA_MARKETPLACE_DB.products.countPending();
            const totalUsers = await BINGA_MARKETPLACE_DB.users.countSellers();
            const pendingUsers = await BINGA_MARKETPLACE_DB.users.countPending();
            const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
            const mediaStats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
            
            const products = await BINGA_MARKETPLACE_DB.products.getAll();
            const totalRevenue = products.reduce((sum, p) => sum + (p.price || 0), 0);
            const totalViews = products.reduce((sum, p) => sum + (p.views || 0), 0);
            
            // Get today's date
            const today = new Date();
            const lastWeek = new Date(today);
            lastWeek.setDate(today.getDate() - 7);
            
            const lastWeekProducts = products.filter(p => new Date(p.createdAt) >= lastWeek).length;
            
            const html = `
                <h3>System Statistics</h3>
                <p style="color: #666; margin-bottom: 30px;">
                    Overview of marketplace performance and usage
                </p>
                
                <div class="dashboard-stats" style="margin-bottom: 40px;">
                    <div class="stat-card admin">
                        <div class="stat-number">${totalProducts}</div>
                        <div>Total Products</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">
                            ${activeProducts} active ‚Ä¢ ${pendingProducts} pending
                        </div>
                    </div>
                    
                    <div class="stat-card admin">
                        <div class="stat-number">${totalUsers}</div>
                        <div>Total Sellers</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">
                            ${pendingUsers} pending approval
                        </div>
                    </div>
                    
                    <div class="stat-card admin">
                        <div class="stat-number">${totalAttractions}</div>
                        <div>Tourist Attractions</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">
                            Showcasing Binga
                        </div>
                    </div>
                    
                    <div class="stat-card admin">
                        <div class="stat-number">${totalViews}</div>
                        <div>Total Views</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">
                            Product impressions
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="margin-bottom: 20px;">Recent Activity</h4>
                        <div style="display: grid; gap: 15px;">
                            <div style="display: flex; justify-content: space-between; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0;">
                                <div>New Products (7 days)</div>
                                <div style="font-weight: bold; color: var(--accent);">${lastWeekProducts}</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0;">
                                <div>Storage Used</div>
                                <div style="font-weight: bold;">${mediaStats.formattedSize}</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0;">
                                <div>Media Files</div>
                                <div style="font-weight: bold;">${mediaStats.count}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="margin-bottom: 20px;">Quick Actions</h4>
                        <div style="display: grid; gap: 15px;">
                            <button class="btn" onclick="showAdminTab('pending')" style="background: var(--warning); color: white; text-align: left;">
                                <i class="fas fa-clock"></i> Review Pending Approvals (${pendingProducts + pendingUsers})
                            </button>
                            <button class="btn" onclick="showAddAttractionForm()" style="background: var(--tourist); color: white; text-align: left;">
                                <i class="fas fa-plus"></i> Add Tourist Attraction
                            </button>
                            <button class="btn" onclick="updateStorageStats()" style="background: var(--primary); color: white; text-align: left;">
                                <i class="fas fa-sync"></i> Refresh Statistics
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h4><i class="fas fa-chart-line"></i> Performance Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">$${totalRevenue.toFixed(2)}</div>
                            <div style="font-size: 14px; color: #666;">Total Listed Value</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">${Math.round(totalViews / Math.max(totalProducts, 1))}</div>
                            <div style="font-size: 14px; color: #666;">Avg Views per Product</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--tourist);">${lastWeekProducts}</div>
                            <div style="font-size: 14px; color: #666;">New Listings (7 days)</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Load admin settings
        async function loadAdminSettings() {
            const settings = await BINGA_MARKETPLACE_DB.settings.get('site_settings') || {};
            
            const html = `
                <h3>System Settings</h3>
                <p style="color: #666; margin-bottom: 30px;">
                    Configure marketplace settings and preferences
                </p>
                
                <form id="settingsForm">
                    <div style="display: grid; gap: 25px;">
                        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <h4 style="margin-bottom: 20px;">Site Information</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Site Name</label>
                                <input type="text" class="form-control" id="siteName" value="${settings.siteName || 'Binga Marketplace'}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Admin Phone</label>
                                <input type="tel" class="form-control" id="adminPhone" value="${settings.adminPhone || '263772863815'}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Admin Email</label>
                                <input type="email" class="form-control" id="adminEmail" value="${settings.adminEmail || 'admin@bingamarket.co.zw'}">
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <h4 style="margin-bottom: 20px;">Upload Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Maximum File Size (MB)</label>
                                <input type="number" class="form-control" id="maxFileSize" value="${settings.maxFileSize || 50}" min="1" max="100">
                                <small style="color: #666;">Maximum size for individual files</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Maximum Files per Ad</label>
                                <input type="number" class="form-control" id="maxFilesPerAd" value="${settings.maxFilesPerAd || 20}" min="1" max="50">
                                <small style="color: #666;">Maximum media files per product/ad</small>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <h4 style="margin-bottom: 20px;">Approval Settings</h4>
                            
                            <div class="form-group">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="autoApproveSellers" ${settings.autoApproveSellers ? 'checked' : ''} style="width: auto;">
                                    <label class="form-label" style="margin-bottom: 0;">Auto-approve new seller accounts</label>
                                </div>
                                <small style="color: #666;">If disabled, all new sellers require manual approval</small>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <h4 style="margin-bottom: 20px;">Currency & Display</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Currency</label>
                                <select class="form-control" id="currency">
                                    <option value="USD" ${settings.currency === 'USD' ? 'selected' : ''}>US Dollar ($)</option>
                                    <option value="ZWL" ${settings.currency === 'ZWL' ? 'selected' : ''}>Zimbabwean Dollar (ZWL)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            
                            <button type="button" class="btn" onclick="resetSettings()" style="background: #f0f0f0;">
                                Reset to Defaults
                            </button>
                        </div>
                    </div>
                </form>
            `;
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Save settings
        async function saveSettings() {
            showLoading();
            try {
                const settings = {
                    siteName: document.getElementById('siteName').value,
                    adminPhone: document.getElementById('adminPhone').value,
                    adminEmail: document.getElementById('adminEmail').value,
                    maxFileSize: parseInt(document.getElementById('maxFileSize').value) || 50,
                    maxFilesPerAd: parseInt(document.getElementById('maxFilesPerAd').value) || 20,
                    autoApproveSellers: document.getElementById('autoApproveSellers').checked,
                    currency: document.getElementById('currency').value,
                    updatedAt: new Date().toISOString()
                };
                
                await BINGA_MARKETPLACE_DB.settings.update('site_settings', settings);
                
                // Add admin log
                addAdminLog('update_settings', { settings: settings });
                
                showToast('Settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error saving settings', 'error');
            } finally {
                hideLoading();
            }
        }

        // Reset settings
        function resetSettings() {
            if (confirm('Reset all settings to defaults?')) {
                loadAdminSettings();
                showToast('Settings reset to form defaults', 'info');
            }
        }

        // Load danger zone
        async function loadDangerZone() {
            const mediaStats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
            const totalProducts = await BINGA_MARKETPLACE_DB.products.count();
            const totalUsers = await BINGA_MARKETPLACE_DB.users.countSellers();
            const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
            
            const html = `
                <div style="border: 2px solid var(--danger); border-radius: 8px; padding: 30px;">
                    <h3 style="color: var(--danger); margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> Danger Zone
                    </h3>
                    <p style="color: #666; margin-bottom: 30px;">
                        These actions are irreversible and will permanently delete data. Use with extreme caution.
                    </p>
                    
                    <div style="display: grid; gap: 25px;">
                        <div style="background: #fff5f5; padding: 20px; border-radius: 6px; border: 1px solid #fed7d7;">
                            <h4 style="color: var(--danger); margin-bottom: 15px;">Clear All Media</h4>
                            <p style="color: #666; margin-bottom: 15px;">
                                This will delete all uploaded photos and videos (${mediaStats.formattedSize}).
                            </p>
                            <button class="btn" onclick="clearAllMedia()" style="background: var(--danger); color: white;">
                                <i class="fas fa-trash-alt"></i> Clear All Media
                            </button>
                        </div>
                        
                        <div style="background: #fff5f5; padding: 20px; border-radius: 6px; border: 1px solid #fed7d7;">
                            <h4 style="color: var(--danger); margin-bottom: 15px;">Delete All Products</h4>
                            <p style="color: #666; margin-bottom: 15px;">
                                This will delete all ${totalProducts} products and their associated media.
                            </p>
                            <button class="btn" onclick="deleteAllProducts()" style="background: var(--danger); color: white;">
                                <i class="fas fa-trash-alt"></i> Delete All Products
                            </button>
                        </div>
                        
                        <div style="background: #fff5f5; padding: 20px; border-radius: 6px; border: 1px solid #fed7d7;">
                            <h4 style="color: var(--danger); margin-bottom: 15px;">Delete All Tourist Attractions</h4>
                            <p style="color: #666; margin-bottom: 15px;">
                                This will delete all ${totalAttractions} tourist attractions and their media.
                            </p>
                            <button class="btn" onclick="deleteAllAttractions()" style="background: var(--danger); color: white;">
                                <i class="fas fa-trash-alt"></i> Delete All Attractions
                            </button>
                        </div>
                        
                        <div style="background: #fff5f5; padding: 20px; border-radius: 6px; border: 1px solid #fed7d7;">
                            <h4 style="color: var(--danger); margin-bottom: 15px;">Reset Entire Database</h4>
                            <p style="color: #666; margin-bottom: 15px;">
                                This will delete ALL data including products, users, attractions, and settings.
                            </p>
                            <button class="btn" onclick="resetDatabase()" style="background: var(--danger); color: white;">
                                <i class="fas fa-database"></i> Reset Entire Database
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h4 style="margin-bottom: 15px;">Database Export & Import</h4>
                        <p style="color: #666; margin-bottom: 15px;">
                            Backup and restore your database
                        </p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn" onclick="exportDatabase()" style="background: var(--primary); color: white;">
                                <i class="fas fa-download"></i> Export Database
                            </button>
                            <button class="btn" onclick="importDatabase()" style="background: var(--accent); color: white;">
                                <i class="fas fa-upload"></i> Import Database
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = html;
        }

        // Clear all media
        async function clearAllMedia() {
            if (!confirm('WARNING: This will delete ALL uploaded photos and videos permanently! Continue?')) {
                return;
            }
            
            const password = prompt('Enter admin password to confirm:');
            if (password !== 'PickGod') {
                showToast('Incorrect password! Operation cancelled.', 'error');
                return;
            }
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.media.deleteAll();
                
                // Add admin log
                addAdminLog('clear_all_media', {});
                
                showToast('All media cleared successfully', 'success');
                updateStorageStats();
                showAdminTab('danger');
            } catch (error) {
                console.error('Error clearing all media:', error);
                showToast('Error clearing media', 'error');
            } finally {
                hideLoading();
            }
        }

        // Delete all attractions
        async function deleteAllAttractions() {
            if (!confirm('WARNING: This will delete ALL tourist attractions permanently! Continue?')) {
                return;
            }
            
            const password = prompt('Enter admin password to confirm:');
            if (password !== 'PickGod') {
                showToast('Incorrect password! Operation cancelled.', 'error');
                return;
            }
            
            showLoading();
            try {
                await BINGA_MARKETPLACE_DB.attractions.deleteAll();
                
                // Add admin log
                addAdminLog('delete_all_attractions', {});
                
                showToast('All attractions deleted successfully', 'success');
                loadAdminDashboard();
                showAdminTab('danger');
            } catch (error) {
                console.error('Error deleting all attractions:', error);
                showToast('Error deleting attractions', 'error');
            } finally {
                hideLoading();
            }
        }

        // Reset database
        async function resetDatabase() {
            if (!confirm('WARNING: This will delete ALL data and reset the entire application! Continue?')) {
                return;
            }
            
            if (!confirm('ARE YOU ABSOLUTELY SURE? This cannot be undone!')) {
                return;
            }
            
            const password = prompt('Enter admin password to confirm:');
            if (password !== 'PickGod') {
                showToast('Incorrect password! Operation cancelled.', 'error');
                return;
            }
            
            showLoading();
            try {
                // Close the database connection
                if (db) {
                    db.close();
                }
                
                // Delete the entire database
                const request = indexedDB.deleteDatabase(DB_NAME);
                
                request.onsuccess = function() {
                    // Add admin log (to localStorage since DB is gone)
                    const log = {
                        id: Date.now(),
                        action: 'reset_database',
                        timestamp: new Date().toISOString(),
                        username: currentUser?.username || 'admin'
                    };
                    
                    let logs = JSON.parse(localStorage.getItem('binga_admin_logs') || '[]');
                    logs.push(log);
                    localStorage.setItem('binga_admin_logs', JSON.stringify(logs));
                    
                    // Clear local storage
                    localStorage.removeItem('binga_current_user');
                    
                    // Reload the page to reinitialize
                    showToast('Database reset successfully! Page will reload...', 'success');
                    setTimeout(() => location.reload(), 2000);
                };
                
                request.onerror = function() {
                    showToast('Error resetting database', 'error');
                    hideLoading();
                };
                
            } catch (error) {
                console.error('Error resetting database:', error);
                showToast('Error resetting database', 'error');
                hideLoading();
            }
        }

        // Export database
        async function exportDatabase() {
            showLoading();
            try {
                const data = {
                    products: await BINGA_MARKETPLACE_DB.products.getAll(),
                    users: await BINGA_MARKETPLACE_DB.users.getAll(),
                    attractions: await BINGA_MARKETPLACE_DB.attractions.getAll(),
                    media: await BINGA_MARKETPLACE_DB.media.getAll(),
                    settings: await BINGA_MARKETPLACE_DB.settings.getAll?.(),
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `binga-marketplace-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Add admin log
                addAdminLog('export_database', {});
                
                showToast('Database exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting database:', error);
                showToast('Error exporting database', 'error');
            } finally {
                hideLoading();
            }
        }

        // Import database
        async function importDatabase() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!confirm('WARNING: This will replace ALL current data! Backup your database first. Continue?')) {
                    return;
                }
                
                const password = prompt('Enter admin password to confirm:');
                if (password !== 'PickGod') {
                    showToast('Incorrect password! Operation cancelled.', 'error');
                    return;
                }
                
                showLoading();
                try {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Clear existing data
                            await BINGA_MARKETPLACE_DB.products.deleteAll?.();
                            await BINGA_MARKETPLACE_DB.attractions.deleteAll?.();
                            await BINGA_MARKETPLACE_DB.media.deleteAll?.();
                            
                            // Import data
                            if (data.products) {
                                for (const product of data.products) {
                                    await BINGA_MARKETPLACE_DB.products.add(product);
                                }
                            }
                            
                            if (data.attractions) {
                                for (const attraction of data.attractions) {
                                    await BINGA_MARKETPLACE_DB.attractions.add(attraction);
                                }
                            }
                            
                            if (data.media) {
                                for (const media of data.media) {
                                    await BINGA_MARKETPLACE_DB.media.add(media);
                                }
                            }
                            
                            if (data.settings) {
                                for (const setting of data.settings) {
                                    await BINGA_MARKETPLACE_DB.settings.add?.(setting);
                                }
                            }
                            
                            // Add admin log
                            addAdminLog('import_database', { fileName: file.name });
                            
                            showToast('Database imported successfully! Page will reload...', 'success');
                            setTimeout(() => location.reload(), 2000);
                        } catch (parseError) {
                            console.error('Error parsing backup file:', parseError);
                            showToast('Invalid backup file format', 'error');
                            hideLoading();
                        }
                    };
                    
                    reader.readAsText(file);
                } catch (error) {
                    console.error('Error importing database:', error);
                    showToast('Error importing database', 'error');
                    hideLoading();
                }
            };
            
            input.click();
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        // Keyboard shortcuts for admin
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+A for admin panel
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                if (currentUser && currentUser.type === 'admin') {
                    showSection('admin');
                    e.preventDefault();
                }
            }
            
            // Ctrl+Shift+L for logs
            if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                if (currentUser && currentUser.type === 'admin') {
                    showAdminTab('danger');
                    e.preventDefault();
                }
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                if (document.getElementById('authModal').style.display === 'flex') {
                    closeAuthModal();
                }
                if (document.getElementById('mediaModal').style.display === 'flex') {
                    closeMediaModal();
                }
            }
        });

        // Prevent navigation away during upload
        window.addEventListener('beforeunload', function(e) {
            if (isUploading) {
                e.preventDefault();
                e.returnValue = 'Files are currently uploading. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>
